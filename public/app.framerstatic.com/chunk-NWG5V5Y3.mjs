import{E as N,ud as j,wd as B}from"https://app.framerstatic.com/chunk-KMAC4JUD.mjs";import{Ho as y,J as O,eu as F,v as R}from"https://app.framerstatic.com/chunk-MEZTIH57.mjs";import{w as H}from"https://app.framerstatic.com/chunk-4PXICH4C.mjs";import{a as w,e as S,f as D,i as V}from"https://app.framerstatic.com/chunk-ZQUNXESX.mjs";import{v as g}from"https://app.framerstatic.com/chunk-WWEGIMHT.mjs";import{a as m}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{a as A}from"https://app.framerstatic.com/chunk-LQILWJHN.mjs";import{j as v}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var W=g("initializeAssetResolver"),p,x;function Q(n){if(p)throw new Error("initializeAssetResolver() should only be called once");return W.debug("initializeAssetResolver",{assetMap:n}),p=H(A().userContent,n),x=n,p}function L(){if(p===void 0)throw new Error("getAssetResolver() should not be called before initializeAssetResolver()");return p}function Z(){if(x===void 0)throw new Error("getCurrentAssetMapHash() should not be called before initializeAssetResolver()");let n=L(),e=x.hash;return{assetResolver:n,assetMapHash:e}}var $=g("layout-measuring/projection");function X(n){return{x:n.x/n.w,y:n.y/n.w}}function Y(n,e){let t=0,o=0;for(let l=1;l<e.length;l++){let r=e[l];r.x<e[t].x&&(t=l),r.y<e[o].y&&(o=l)}let s=n[t],i=n[o];return m(s!==void 0&&i!==void 0,"minX, minY points must be defined",t,o,n),{minX:new DOMPoint(s.x,s.y),minY:new DOMPoint(i.x,i.y)}}function re(n,e,t,o){let s=n.multiply(e),i=o.map(f=>X(s.transformPoint(f))),{x:l,y:r}=P(n,e,t,Y(o,i)),a=n.translate(l,r).multiplySelf(e),d=o.map(f=>X(a.transformPoint(f)));if(!O.anyPointsOutsideRect(t,d))return{x:l,y:r,matrix:a};let c=P(n,e,t,Y(o,d));return{x:c.x,y:c.y,matrix:n.translate(c.x,c.y).multiplySelf(e)}}function ie(n,e,t){let o=new DOMPoint(e.x,e.y);return P(n,N.identity(),t,{minX:o,minY:o})}function P(n,e,t,{minX:o,minY:s}){let i=n,l=e,r=t,{a,b:d,c}=k(i,l,o,r.x,1),{a:f,b:u,c:h}=k(i,l,s,r.y,2),b=(d*h-u*c)/(f*d-a*u),C=(a*h-f*c)/(a*u-f*d);return f*d===a*u?($.error("Unsolvable coordinates:",{parentMatrix:n,matrix:e,target2dPoint:t,minxp:o,minyp:s}),{x:0,y:0}):{x:b,y:C}}function k(n,e,t,o,s){let i=n["m1"+s],l=e.m14*i*t.x+e.m24*i*t.y+e.m44*i,r=n["m2"+s],a=e.m14*r*t.x+e.m24*r*t.y+e.m44*r,d=n["m3"+s],c=n["m4"+s],f=(e.m11*i+e.m12*r+e.m13*d+e.m14*c)*t.x+(e.m21*i+e.m22*r+e.m23*d+e.m24*c)*t.y+e.m41*i+e.m42*r+e.m43*d+e.m44*c,u=e.m14*n.m14*t.x+e.m24*n.m14*t.y+e.m44*n.m14,h=e.m14*n.m24*t.x+e.m24*n.m24*t.y+e.m44*n.m24,b=(e.m11*n.m14+e.m12*n.m24+e.m13*n.m34+e.m14*n.m44)*t.x+(e.m21*n.m14+e.m22*n.m24+e.m23*n.m34+e.m24*n.m44)*t.y+e.m41*n.m14+e.m42*n.m24+e.m43*n.m34+e.m44*n.m44,C=l-o*u,E=a-o*h,U=o*b-f;return{a:C,b:E,c:U}}function G(){R.frame.addScope("is-hidden",1500),R.component.addScope("is-hidden",1500)}function q(){R.frame.removeScope("is-hidden"),R.component.removeScope("is-hidden")}function I(n,e,t){if(V(n.hidden))return!1;if(w(n.hidden))return n.hidden;try{G();let o=n.hidden(e,t);return q(),o}catch{return q(),!1}}var T=class{constructor(e){this.engine=e}async requestHiddenStateForComponentControls(e){let t=e.args,o=this.engine.tree,s={};return Object.entries(t).forEach(([i,{controlNames:l}])=>{let r=o.getNode(i);if(!r)return;m(F(r),"Node is not a CanvasNode with control props (node.__class: ",r.__class,")");let a=r.getControlPropSourceIdentifier();m(a,"Cannot find component identifier for node");let d=y.reactComponentForIdentifier(a);if(!d||!d.properties)return;let c=l??Object.keys(d.properties),f=r.getResolvedControlPropValues(y);s[i]=_(c,d,f)}),{hiddenControlsByNodeId:s}}async requestHiddenStateForActionControls(e){let{actionIdentifier:t,controlNames:o,actionProps:s}=e;m(t,"Fail to request hidden state for action controls: missing actionIdentifier");let i=y.componentForIdentifier(t);return{hiddenState:o.reduce((r,a)=>{let d=i?i.properties[a]:void 0;return d?(r[a]=I(d,s,s),r):(r[a]=!1,r)},{})}}async requestHiddenStateForModuleControls(e){let t=y.reactComponentForIdentifier(e.moduleIdentifier);if(!t?.properties)return{hiddenState:{}};let o=B({assetResolverWithHash:null,variableValueResolver:{getVariableReferenceValue(){throw new Error("getVariableReferenceValue is not implemented for ControlsVisibilityServiceImplementation")}},getResolvedFetchDataValue:void 0,getVariableControlByReference(){throw new Error("getVariableControlByReference is not implemented for  ControlsVisibilityServiceImplementation")},getCanvasTree:()=>this.engine.tree,definitionProvider:y});return{hiddenState:_(e.controlNames??Object.keys(t.properties),t,j(t.properties,e.moduleProps,o))}}};function M(n,e,t,o,s,i){let l=n+e;if(t){if(t.hidden&&(i[l]=I(t,o,s)),t.type==="object"){let r=o[e];if(!S(r))return;for(let a in t.controls){let d=t.controls[a];M(l+".",a,d,r,s,i)}}if(t.type==="array"&&t.control.type==="object"){let r=o[e];if(!D(r))return;let a=r.length;for(let d=0;d<a;d++){let c=r[d];if(S(c))for(let f in c){let u=t.control.controls[f];M(l+`[${d}].`,f,u,c,s,i)}}}}}function _(n,e,t){let o={};for(let s of n){let i=e.properties[s];M("",s,i,t,t,o)}return o}var z=class{constructor(e){this.environment=e;v(this,"visibleRenderIds",new Set);v(this,"addedRenderIds",new Set);v(this,"removedRenderIds",new Set)}setVisible(e,t){m(this.environment==="sandbox","Setting data is only allowed in the sandbox.");let o=this.getVisible(e);t!==o&&(t?(this.visibleRenderIds.add(e),this.addedRenderIds.add(e),this.removedRenderIds.delete(e)):(this.visibleRenderIds.delete(e),this.removedRenderIds.add(e),this.addedRenderIds.delete(e)))}import(e){m(this.environment==="editor","Importing data is only allowed in the editor.");let t=new Set;for(let o of e.addedRenderIds)this.visibleRenderIds.add(o),t.add(o);for(let o of e.removedRenderIds)this.visibleRenderIds.delete(o),t.add(o);return t}getVisible(e){return this.visibleRenderIds.has(e)}export(){m(this.environment==="sandbox","No need to collect and send updates from within the editor.");let e=Array.from(this.addedRenderIds),t=Array.from(this.removedRenderIds);return this.addedRenderIds.clear(),this.removedRenderIds.clear(),{addedRenderIds:e,removedRenderIds:t}}};export{re as a,ie as b,T as c,z as d,Q as e,L as f,Z as g};
//# sourceMappingURL=https://app.framerstatic.com/chunk-NWG5V5Y3.mjs.map

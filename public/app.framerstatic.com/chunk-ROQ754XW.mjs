import{e as M}from"https://app.framerstatic.com/chunk-CEHFNECT.mjs";import{Ha as de,Wg as N,c as ae,d as le,f as ce,jg as I,o as F}from"https://app.framerstatic.com/chunk-HABMTUSV.mjs";import{e as se}from"https://app.framerstatic.com/chunk-OOEWJVJW.mjs";import{Ed as me}from"https://app.framerstatic.com/chunk-KMAC4JUD.mjs";import{$e as ee,Ad as w,Be as A,Cd as L,Oe as Z,Si as ne,Ue as j,Ve as _,cd as E,kc as $,lf as te,m as G,mc as J,of as oe,rf as ie,ue as X,vd as q,wd as x,xd as Q,xe as Y,xu as re}from"https://app.framerstatic.com/chunk-MEZTIH57.mjs";import{b as g,d as H,e as T,f as y}from"https://app.framerstatic.com/chunk-ZQUNXESX.mjs";import{p as z,v as B}from"https://app.framerstatic.com/chunk-WWEGIMHT.mjs";import{a as v}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{j as C}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var O=class extends Error{constructor(e,i){super(`Document version is too low. Expected ${i}, got ${e}.`)}},V=class extends Error{constructor(e,i){super(`Document version is too high. Expected ${i}, got ${e}.`)}};function fe(t){if(!le(t)||t===null)throw Error("Invalid document.");if(!H(t.version))throw Error("Unable to read document.version");if(!t.root)throw Error("Unable to read document.root");if(t.version<N.minimumLegacySerializationVersion)throw new O(t.version,N.minimumLegacySerializationVersion);if(t.version>F)throw new V(t.version,F)}function D(t,e){let i=!1;function o(d,s,l){if(!d)return;let a=d.id;if(l.has(a)){i=!0,e&&e.push({id:a,stack:s.slice()});return}if(l.add(a),s.push(a),A(d)){let c=d.getRawControlProps(),f=Object.keys(c);for(let u of f){let p=c[u];if(p){if(p.type==="slot"&&y(p.value))for(let h of p.value){if(!T(h))continue;let k=h["reference"];if(!g(k))continue;let Ne=t.get(k);o(Ne,s,l)}else if(p.type==="componentinstance"&&g(p.value)){let h=t.get(p.value);o(h,s,l)}else if(y(p.value))for(let h of p.value){if(!T(h)||h.type!=="componentinstance")continue;let b=h.value;if(!g(b))continue;let k=t.get(b);o(k,s,l)}}}}let m=d.children;if(m)for(let c=0,f=m.length;c<f;c++)o(m[c],s,l);l.delete(a),s.pop()}let n=new Set,r=[];return o(t.root,r,n),i}function je(t,e){fe(t);let i=ce(t),o=I(i.root,null,{extraChecksAndFixes:!0,errors:e,warnings:e});if(!o)throw Error("Unable to create load document");pe(o,e);let n=new Map;R(n,e,o,$),ue(n,o,e);let r=N.createByAdoptingRoot(o);r.verify(),r=re.treeDidLoad(r,e).didNonLinearMove(G);let d=[];return D(r,d)&&(d.forEach(s=>{e.push(`${s.id}: code component links itself via ${s.stack}`),W(r,s.id,s.stack)}),r=r.commit()),r}function _e(t,e){pe(t,e);let i=new Map;R(i,e,t,$),ue(i,t,e)}function K(t,e){let i=new Map;R(i,e,t,t.parentid),we(i,t,e)}function Ae(t){return Y(t)||X(t)}function pe(t,e=[]){let i=t.children,o=i.find(Ae);o===void 0&&(e.push(`${t.id}: Root does not contain a page`),o=new de({id:ae(t)}),i.push(o));for(let n=0;n<i.length;n++){let r=i[n];r&&(se(r)||Q(r)||ie(r)||me(r)||ee(r)||Z(r)||j(r)||te(r)||oe(r)||_(r)||(e.push(`${r.id}: Ground node is not on a page`),i.splice(n--,1),o.children.push(r),r.parentid=o.id))}}function W(t,e,i){let o=t.get(i[i.length-1]);if(!A(o))return;let n=o.getRawControlProps(),r={};for(let s in n){let l=n[s];if(!l)continue;let{type:a,value:m}=l;if(a==="slot"&&y(m)){let c=m.filter(f=>T(f)?f["reference"]!==e:!0);c.length!==m.length&&(r[s]={type:"slot",value:c})}else if(a==="componentinstance"&&m===e)r[s]={type:"slot",value:[]};else if(y(m)){let c=m.filter(f=>!T(f)||f.type!=="componentinstance"?!0:f.value!==e);c.length!==m.length&&(r[s]={type:"array",value:c})}}if(z(r))return;let d=ne(r);o.set(d)}function R(t,e,i,o){for(i.parentid=o;t.has(i.id);)e.push(`${i.id}: duplicate id in document`),i.id=J();t.set(i.id,i);let n=i.children;if(n)for(let r=0,d=n.length;r<d;r++)R(t,e,n[r],i.id)}function ue(t,e,i){for(let o of e.walk())v(o.isMutable()),A(o)&&he(t,o.id,new Set([o.id]),o,i),x(o)&&ge(t,o,o,i),w(o)&&(Ce(t,o,i),ve(t,o,i)),L(o)&&Te(o,i)}function we(t,e,i){for(let o of e.walk())v(o.isMutable()),w(o)?ve(t,o,i):L(o)&&Te(o,i)}function he(t,e,i,o,n){function r(l){if(!g(l))return!1;if(i.has(l))return n.push(`${e}: code component links itself via ${o.id}`),!0;let a=t.get(l);if(!a)return n.push(`${o.id}: code component has bad link at ${l}`),!0;let m=!1;for(let c of a.walk())i.has(c.id)?(n.push(`${e}: code component links itself via ${o.id} via ${l}`),m=!0):A(c)&&he(t,e,new Set([...i,c.id]),c,n);return m}let d=o.getRawControlProps(),s=Object.keys(d);for(let l of s){let a=d[l];if(!E(a))continue;if(a.type==="slot"&&y(a.value)){let f=[];for(let u=0;u<a.value.length;u++){let p=a.value[u];if(!T(p))continue;let b=p["reference"];g(b)&&r(b)&&f.push(u)}for(;f.length>0;)a.value.splice(f.pop(),1);continue}if(a.type==="componentinstance"&&g(a.value)){if(!r(a.value))continue;a.value=void 0;continue}let m=a.value;if(!Array.isArray(m))continue;let c=[];for(let f=0,u=m.length;f<u;f++){let p=m[f];E(p)&&p.type==="componentinstance"&&g(p.value)&&r(p.value)&&c.push(f)}for(;c.length>0;)m.splice(c.pop(),1)}}function U(t){t.originalid=null,t.replicaInfo=null}function ge(t,e,i,o){for(let n of i.walk())if(n!==i&&q(n)&&w(n)){let r=Ce(t,n,o);if(!r)continue;if(e===r){o.push(`${e.id}: template component links itself via ${i.id}`),U(n);continue}ge(t,e,r,o)}}function Ce(t,e,i){let o=e.replicaInfo.master,n=t.get(o);return n?x(n)?(e.originalid!==o&&(i.push(`${e.id}: template originalid doesn't point to master id: ${e.originalid}`),e.originalid=o),n):(i.push(`${e.id}: template references a node that is not a master: ${o}`),U(e),null):(i.push(`${e.id}: template references a master that doesn't exist: ${o}`),U(e),null)}function ve(t,e,i){if(!e.replicaInfo)return;let o=e.replicaInfo.inheritsFrom;if(!o)return;let n=t.get(o);n?!x(n)&&!w(n)&&(i.push(`${e.id}: template references an inherit that isn't a master or a replica: ${o}`),e.replicaInfo.inheritsFrom=void 0):(i.push(`${e.id}: template references an inherit that doesn't exist: ${o}`),e.replicaInfo.inheritsFrom=void 0)}function Te(t,e){t.originalid&&(t.originalid=null,e.push(`${t.id}: removing original id from orphan replica child`))}var S=B("remote:verify");function at(t,e,i){let o=t.getPartialDocumentForPageIds(e),n=[],r=S.isLoggingTraceMessages()?[]:void 0,d=I(o,null,{extraChecksAndFixes:!0,errors:n,warnings:r});M("parsingRootNode"),v(d,"error loading root node:",o.id,n);for(let l of d.children??[])l.children&&l.children.length>0&&K(l,n);n.length>0&&S.warn("errors loading server tree: "+n.join(`
`)),r&&r.length>0&&S.trace("warnings loading server tree: "+r.join(`
`));let s=N.createByAdoptingRoot(d,i);return s.loadReplicasAndCodeComponents(s.root),M("parsingReplicasExpansion"),s.hasUncommittedChanges()&&(s=s.commit()),s}function lt(t,e){let i=t.parseNextPage();if(!i)return!0;let o=[],n=I(i,t.root.id,{extraChecksAndFixes:!0,errors:o});return v(n,"error loading page node:",i.id,o),K(n,o),o.length>0&&S.warn("warnings loading server tree: "+o.join(`
`)),e.set(n.id,n),!1}function ct(t,e){t.makeLatest(),t.editClosed=!1,t.isViewOnly=!1;for(let[i,o]of t.root.children.entries()){let n=e.get(o.id);n&&(t.remove(n.id),t.insertNode(n,t.root.id,i))}return t.inEditor=!1,t.loadReplicasAndCodeComponents(t.root),t.hasUncommittedChanges()&&(t=t.commit()),t.inEditor=!0,t}var P=class t{constructor(){C(this,"editClosed",!1);C(this,"isViewOnly",!1);C(this,"inEditor",!1);C(this,"processingLocalUserEdits",!1)}static from(e){let i=new t;return i.editClosed=e.editClosed,i.isViewOnly=e.isViewOnly,i.inEditor=e.inEditor,i.processingLocalUserEdits=e.processingLocalUserEdits,i}restore(e){e.editClosed=this.editClosed,e.isViewOnly=this.isViewOnly,e.inEditor=this.inEditor,e.processingLocalUserEdits=this.processingLocalUserEdits}static setForAssembly(e){e.editClosed=!1,e.isViewOnly=!1,e.inEditor=!1,e.processingLocalUserEdits=!1}},ye=class{constructor(e,i,o){this.engine=e;this.treeToAssemble=i;C(this,"pagesToAssemble");C(this,"isSetupNeeded",!0);C(this,"engineTreeFlags",new P);this.pagesToAssemble=Array.from(o.values())}setupAssemblerTreeStateIfNeeded(){this.isSetupNeeded&&(this.isSetupNeeded=!1,this.engineTreeFlags=P.from(this.engine.tree),this.treeToAssemble.isLatest()||this.treeToAssemble.makeLatest(),P.setForAssembly(this.treeToAssemble))}restoreEngineTreeState(){this.isSetupNeeded||(this.isSetupNeeded=!0,this.treeToAssemble.hasUncommittedChanges()&&(this.treeToAssemble=this.treeToAssemble.commit()),this.engine.tree.isLatest()||this.engine.tree.makeLatest(),this.engineTreeFlags.restore(this.engine.tree))}assembleOnePage(){if(this.pagesToAssemble.length===0)return!0;this.setupAssemblerTreeStateIfNeeded();let e=this.pagesToAssemble.pop();v(e);let i=this.treeToAssemble.root.children.findIndex(o=>o.id===e.id);return i<0?!1:(this.treeToAssemble.remove(e.id),this.treeToAssemble.insertNode(e,this.treeToAssemble.root.id,i),this.treeToAssemble.loadReplicasAndCodeComponents(e),this.treeToAssemble=this.treeToAssemble.commit(),this.pagesToAssemble.length===0)}buildCompleteTree(){v(this.pagesToAssemble.length===0,"must be done with assembleOnePage"),this.setupAssemblerTreeStateIfNeeded(),this.treeToAssemble.loadReplicasAndCodeComponents(this.treeToAssemble.root),this.treeToAssemble.hasUncommittedChanges()&&(this.treeToAssemble=this.treeToAssemble.commit()),this.treeToAssemble.verify();let e=[],i=[];return D(this.treeToAssemble,i)&&(i.forEach(o=>{e.push(`${o.id}: code component links itself via ${o.stack}`),W(this.treeToAssemble,o.id,o.stack)}),this.treeToAssemble=this.treeToAssemble.commit()),e.length>0&&S.warn("warnings loading server tree: "+e.join(`
`)),this.engineTreeFlags.restore(this.treeToAssemble),this.treeToAssemble}};export{D as a,je as b,_e as c,K as d,W as e,at as f,lt as g,ct as h,P as i,ye as j};
//# sourceMappingURL=https://app.framerstatic.com/chunk-ROQ754XW.mjs.map

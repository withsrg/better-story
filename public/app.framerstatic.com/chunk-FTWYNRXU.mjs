import{c as V,d as k}from"https://app.framerstatic.com/chunk-LKMP537Z.mjs";import{a as L,b as A}from"https://app.framerstatic.com/chunk-JX6NUTD4.mjs";import{c as x,e as v,h as _,k as w}from"https://app.framerstatic.com/chunk-XDXIFLRG.mjs";import{f as P,m as y,n as F,v as T}from"https://app.framerstatic.com/chunk-WWEGIMHT.mjs";import{b as O}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{e as E}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var{onewayMethodTemplate:ie,voidMethodTemplate:ce,valueMethodTemplate:se,streamMethodTemplate:I}=w,R;(a=>a.service={id:"__Flags__",fingerprint:"2dc758b5859fc43cd99a9ea5569fd9d8",methods:{experimentsUpdatesStream:{},employeesOnlySettingsUpdatesStream:{},projectFeaturesUpdatesStream:{}},newOutgoingWrapper:i=>({experimentsUpdatesStream:I.bind(-1,"experimentsUpdatesStream",i),employeesOnlySettingsUpdatesStream:I.bind(-1,"employeesOnlySettingsUpdatesStream",i),projectFeaturesUpdatesStream:I.bind(-1,"projectFeaturesUpdatesStream",i)})})(R||={});var W;(n=>{n.service=R.service;function a(t){let o=v.shared();return{expect:()=>o.expectWithoutDiscovery(n.service,t),discover:c=>o.discover(n.service,t,c),register:c=>o.register({channel:t,service:n.service,implementation:c})}}n.on=a;async function i(t){v.shared().unregister(t)}n.unregister=i})(W||={});var{onewayMethodTemplate:Re,voidMethodTemplate:be,valueMethodTemplate:Ce,streamMethodTemplate:j}=w,b;(a=>a.service={id:"__ModulesUpdates__",fingerprint:"94442ac22b31297c9938132d5ea74437",methods:{moduleUpdatesStream:{}},newOutgoingWrapper:i=>({moduleUpdatesStream:j.bind(-1,"moduleUpdatesStream",i)})})(b||={});var J;(n=>{n.service=b.service;function a(t){let o=v.shared();return{expect:()=>o.expectWithoutDiscovery(n.service,t),discover:c=>o.discover(n.service,t,c),register:c=>o.register({channel:t,service:n.service,implementation:c})}}n.on=a;async function i(t){v.shared().unregister(t)}n.unregister=i})(J||={});var h=E(L());function Le(r,a){let i={service:r.service.service,onDiscover:r.onDiscover},n=(0,h.useRef)(i);if(n.current.service!==i.service)throw new Error("useServiceStream: service must be identical between re-renders");let t={onStreamValue:a,onError:r.onError},o=(0,h.useRef)(t);o.current=t;let c=(0,h.useRef)(),g=()=>{let d=c.current;c.current=void 0,d?.cancel().catch(()=>{})},{channel:S}=r;(0,h.useEffect)(()=>S?((async()=>{let s=!1,M=0;for(;!s;){s=!0;try{let e=n.current,l=await v.shared().discover(e.service,S),f=e.onDiscover(l);c.current=f,M=0,await f.read(m=>o.current.onStreamValue(m))}catch(e){let l=o.current.onError(F(e));if(M++,M>1)continue;l?.retry===!0&&(await P(0),s=!1)}}})().catch(y),g):void 0,[S])}function Ae(r){if(r instanceof x.ServiceGone)return{retry:!0};y(r)}var p=E(L());var G="autoplay; ambient-light-sensor; accelerometer; camera; display-capture; encrypted-media; fullscreen; geolocation; gyroscope; magnetometer; microphone; midi; picture-in-picture; usb; xr-spatial-tracking",$="autoplay",z="autoplay; ambient-light-sensor; accelerometer; camera; display-capture; encrypted-media; fullscreen; geolocation; gyroscope; magnetometer; microphone; midi; picture-in-picture; usb; xr-spatial-tracking; clipboard-read; clipboard-write";function H(r){let a;switch(r){case"on_page":a=$;break;case"editor":a=G;break;case"preview":a=z;break;default:O(r)}return a}var D=E(A()),Y=T("services:hooks:useiframewithchannel"),C=class extends Error{constructor(i,n={}){super(i);this.extras=n}};function Je(r){let{onSetup:a=()=>{},targetOrigin:i,type:n,src:t}=r,o=t;if(t){let{pathname:e,search:l,hash:f}=new URL(t),m=`${e}${l}${f}`;k(m),o=V(m).url}let[c,g]=(0,p.useReducer)((e,l)=>(e&&v.shared().unregister(e).catch(f=>{f instanceof x.ServiceGone||y(f)}),l),null),S=(0,p.useRef)(null),d=(0,p.useRef)(null),s=(0,p.useRef)({onError:null,onLoad:null});return(0,p.useEffect)(()=>{if(!o||!S.current){d.current=null,c&&g(null);return}if(d.current)return;let e=document.createElement("iframe");e.src=o,e.style.border="none",e.style.display="block",e.style.height="100%",e.style.width="100%",e.dataset.testid=`${n}-iframe`,e.allowFullscreen=!0;let l=u=>{g(null),Y.reportError(new C("iframe load error",{message:u.message,filename:u.filename,lineno:u.lineno,colno:u.colno,error:u.error}))};e.addEventListener("error",l),s.current.onError=l;let f=new URL(o,document.baseURI).origin,m=e.sandbox;m?.add("allow-downloads"),m?.add("allow-popups"),m?.add("allow-popups-to-escape-sandbox"),m?.add("allow-same-origin"),m?.add("allow-scripts"),m?.add("allow-forms"),e.allow=H(n==="canvas"?"editor":"preview"),S.current.appendChild(e),d.current=e;let N=()=>{let{contentWindow:u}=e;return u?new _(u,i??f):(S.current?.removeChild(e),null)},U=()=>{let u=N();g(u)};return e.addEventListener("load",U),s.current.onLoad=U,a(e)},[c,g,a,o,i,n]),(0,p.useEffect)(()=>()=>{s.current.onError&&d.current?.removeEventListener("error",s.current.onError),s.current.onLoad&&d.current?.removeEventListener("load",s.current.onLoad),s.current.onError=null,s.current.onLoad=null,d.current=null,g(null)},[]),[(0,p.useCallback)(function(l){return(0,p.useEffect)(()=>{if(S.current?.children.length===0&&d.current)throw new Error("IFrameWithChannel was re-rendered. The Service connection will be broken.")}),(0,D.jsx)("div",{...l,ref:S})},[]),c,d.current]}export{W as a,J as b,H as c,Je as d,Le as e,Ae as f};
//# sourceMappingURL=https://app.framerstatic.com/chunk-FTWYNRXU.mjs.map

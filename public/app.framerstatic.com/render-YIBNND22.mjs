import{a as Jl}from"https://app.framerstatic.com/chunk-TBHTQC3J.mjs";import"https://app.framerstatic.com/chunk-HOCCVH42.mjs";import{a as at}from"https://app.framerstatic.com/chunk-JD5Y5NXR.mjs";import{a as $l}from"https://app.framerstatic.com/chunk-MTVPXQIM.mjs";import{a as yr,b as Xl,c as Zl}from"https://app.framerstatic.com/chunk-T2XETSTS.mjs";import"https://app.framerstatic.com/chunk-JOT7VP6Y.mjs";import"https://app.framerstatic.com/chunk-UDHGMBBS.mjs";import{$a as H,C as Il,Ca as Qt,Ea as Rl,G as Ul,H as yn,I as wl,Ia as kl,J as Cl,K as xl,L as hn,Ma as Ol,Na as Ml,Oa as Vl,Qa as Ll,Ra as zl,Sa as Wl,V as Pl,Va as Hl,W as Fl,Wa as jl,X as vl,Xa as ur,Y as Sl,Ya as gr,Z as El,_ as Tl,bb as _l,cb as ql,eb as Kl,fb as Gl,gb as Yl,ja as xo,ka as Nl,na as In,oa as Al,p as D,q as Tt,r as v,s as cl,t as dl,ua as Po,wa as Un,ya as Dl,za as Bl}from"https://app.framerstatic.com/chunk-FDH2L5H4.mjs";import"https://app.framerstatic.com/chunk-YK7R3YGS.mjs";import{a as pl,c as ul,d as gl}from"https://app.framerstatic.com/chunk-7XCQX7VG.mjs";import{C as lr,Cb as il,D as Ys,E as cr,G as dr,Gb as al,H as fr,I as $s,K as Xs,Kb as sl,M as Zs,Mb as ll,N as Js,O as Qs,Q as mr,Qa as gn,V as un,f as Hs,kb as nl,r as js,s as _s,u as qs,w as Ks,x as Gs}from"https://app.framerstatic.com/chunk-USLM36KB.mjs";import{a as sr,c as ol,d as rl}from"https://app.framerstatic.com/chunk-RWHKJ5QL.mjs";import{a as it}from"https://app.framerstatic.com/chunk-UPG5HTWJ.mjs";import"https://app.framerstatic.com/chunk-UUM6YMYS.mjs";import"https://app.framerstatic.com/chunk-TUJTSB5Y.mjs";import{J as As,K as Et,N as Ds}from"https://app.framerstatic.com/chunk-W742BX7F.mjs";import"https://app.framerstatic.com/chunk-OOEVJM46.mjs";import{$ as gs,G as ts,H as os,I as cs,Ka as Cs,Q as bt,R as St,Sa as bs,T as V,W as ds,X as ps,Y as us,Z as rr,_ as nr,aa as ys,ba as hs,ca as Zt,ea as ir,fa as ar,ib as Es,kb as Rs,ra as Us,za as ws}from"https://app.framerstatic.com/chunk-OZMR6J2Y.mjs";import{M as Ts,N as Ns,P as Bs,S as ks,o as Fs,q as vs}from"https://app.framerstatic.com/chunk-P3PQNGLR.mjs";import{P as Is}from"https://app.framerstatic.com/chunk-FDLLIFYZ.mjs";import{Ef as is,If as as,Kf as ss,Lf as ls,Mf as tr,Of as or,Td as es,ad as Zo,ba as xa,cd as Qa,ea as Pa,fa as x,ga as Fa,gf as ns,xf as er}from"https://app.framerstatic.com/chunk-ATANOO3H.mjs";import"https://app.framerstatic.com/chunk-CXEH5VJL.mjs";import{f as rs}from"https://app.framerstatic.com/chunk-2PXEF7RD.mjs";import"https://app.framerstatic.com/chunk-UDB4LXQ2.mjs";import"https://app.framerstatic.com/chunk-EDICM4ZE.mjs";import"https://app.framerstatic.com/chunk-MTT6DWBN.mjs";import"https://app.framerstatic.com/chunk-5C7X4FEK.mjs";import"https://app.framerstatic.com/chunk-Z2EPYIAC.mjs";import"https://app.framerstatic.com/chunk-N57XNHE3.mjs";import"https://app.framerstatic.com/chunk-ROQ754XW.mjs";import"https://app.framerstatic.com/chunk-CEHFNECT.mjs";import"https://app.framerstatic.com/chunk-SE354WOV.mjs";import{i as fs,j as ms}from"https://app.framerstatic.com/chunk-YE4QPCYK.mjs";import"https://app.framerstatic.com/chunk-ARJV7VL6.mjs";import{b as bl}from"https://app.framerstatic.com/chunk-7VWPGK6C.mjs";import"https://app.framerstatic.com/chunk-UQ4RVIFT.mjs";import"https://app.framerstatic.com/chunk-3CVNCHSP.mjs";import"https://app.framerstatic.com/chunk-5ETEZDDN.mjs";import"https://app.framerstatic.com/chunk-SQNAW3G7.mjs";import"https://app.framerstatic.com/chunk-YE25YANI.mjs";import"https://app.framerstatic.com/chunk-T5TFDL2K.mjs";import"https://app.framerstatic.com/chunk-BBHDN56U.mjs";import{a as Jt}from"https://app.framerstatic.com/chunk-D4FTY36W.mjs";import"https://app.framerstatic.com/chunk-EWEZCJKH.mjs";import"https://app.framerstatic.com/chunk-Q4ZQNAWB.mjs";import{a as Ws}from"https://app.framerstatic.com/chunk-2SMMFYXI.mjs";import"https://app.framerstatic.com/chunk-CW2QZH3U.mjs";import{a as Za,b as gt}from"https://app.framerstatic.com/chunk-XXKLA2AS.mjs";import{b as tl}from"https://app.framerstatic.com/chunk-UCKPEMKA.mjs";import"https://app.framerstatic.com/chunk-D7MEQ7Y3.mjs";import"https://app.framerstatic.com/chunk-STJXBBCQ.mjs";import"https://app.framerstatic.com/chunk-Z3DM3KLW.mjs";import"https://app.framerstatic.com/chunk-6YIGR7JI.mjs";import{j as Ja}from"https://app.framerstatic.com/chunk-QBRDYVUO.mjs";import"https://app.framerstatic.com/chunk-I24ABD3P.mjs";import"https://app.framerstatic.com/chunk-YS3B4HMG.mjs";import{a as yl,d as hl}from"https://app.framerstatic.com/chunk-ZL2G454K.mjs";import"https://app.framerstatic.com/chunk-7Y7LME3V.mjs";import"https://app.framerstatic.com/chunk-HYOYNA7H.mjs";import"https://app.framerstatic.com/chunk-4OEKL235.mjs";import{a as el}from"https://app.framerstatic.com/chunk-NWKZRGUX.mjs";import{a as zs}from"https://app.framerstatic.com/chunk-GUORAVBZ.mjs";import{a as ml}from"https://app.framerstatic.com/chunk-EDWTDTCV.mjs";import{d as Ps,e as Ss}from"https://app.framerstatic.com/chunk-NWG5V5Y3.mjs";import{a as xs}from"https://app.framerstatic.com/chunk-WFUEGI6N.mjs";import{e as vt,h as Jo,k as Qo,l as nt,s as ce}from"https://app.framerstatic.com/chunk-NDPPBRVU.mjs";import"https://app.framerstatic.com/chunk-DZJERIIY.mjs";import{Gc as Pt,Hg as Yo,Ig as wa,Ka as Go,Od as mn,Pd as pn,Wg as Ca,Yb as fa,ed as Ft,ee as ya,fe as ha,gc as ma,ge as Ia,he as Ua,la as dn,yd as ua,zd as ga}from"https://app.framerstatic.com/chunk-HABMTUSV.mjs";import"https://app.framerstatic.com/chunk-OOEWJVJW.mjs";import{e as pa,f as ke}from"https://app.framerstatic.com/chunk-XWGDE7KU.mjs";import"https://app.framerstatic.com/chunk-Y4KSD2WZ.mjs";import"https://app.framerstatic.com/chunk-HIIZXDON.mjs";import{c as fl}from"https://app.framerstatic.com/chunk-FTWYNRXU.mjs";import"https://app.framerstatic.com/chunk-NSQUS545.mjs";import"https://app.framerstatic.com/chunk-35KIRN6L.mjs";import{$e as La,Dg as Ya,Ee as Oa,Eg as $a,Fe as Ee,If as ja,J as Na,Jf as _a,Le as G,Of as Yt,Pf as $t,Re as rt,Rf as Xt,S as Aa,Tf as Xo,Tg as Xa,Vc as Ra,We as Ma,Ze as Va,b as Sa,bg as qa,h as Ea,hf as $o,lb as Da,lf as za,m as Ta,mf as Wa,of as Ha,ub as Ba,ye as ka,yg as Ka,zg as Ga}from"https://app.framerstatic.com/chunk-OMLUVIS3.mjs";import"https://app.framerstatic.com/chunk-2YBKPFFE.mjs";import"https://app.framerstatic.com/chunk-NITQ6GUY.mjs";import"https://app.framerstatic.com/chunk-OOKYJP4H.mjs";import"https://app.framerstatic.com/chunk-EPGT6RL3.mjs";import{a as pr}from"https://app.framerstatic.com/chunk-KECLZCQL.mjs";import{a as Ms}from"https://app.framerstatic.com/chunk-E3YELZI3.mjs";import{a as X}from"https://app.framerstatic.com/chunk-QFU6OGL3.mjs";import{a as Os,b as Vs,c as Ls}from"https://app.framerstatic.com/chunk-CTKJD4ES.mjs";import"https://app.framerstatic.com/chunk-SARVT3TF.mjs";import"https://app.framerstatic.com/chunk-TYPTT5TV.mjs";import{Re as Ko,kc as Re,o as aa,p as sa,qd as da,wb as la,xf as fn}from"https://app.framerstatic.com/chunk-KMAC4JUD.mjs";import{$q as ln,Ad as zi,Ae as E,Af as Ki,Be,C as ae,Cd as Wi,Ee as _t,Er as ra,Fe as Ze,Ff as qt,Ft as Ho,Gt as jo,Ht as _o,It as qo,J as De,Jo as Zi,Kd as Oo,Kl as an,Lp as sn,Lw as ca,Ma as ki,Or as pt,Pj as $i,Qb as Li,Sb as ko,Si as nn,Sn as re,Ta as tn,Tp as Qi,Up as ea,Wn as Gt,Xd as Hi,Yb as Le,ao as Xi,ar as ta,dj as Mo,ha as me,hb as Mi,hj as Yi,hk as Vo,ib as Vi,jb as O,jk as wo,jr as cn,kc as on,m as F,ne as Uo,ng as Gi,np as Ji,oe as ji,ok as Lo,ol as Kt,ou as Co,pt as ut,qe as rn,qt as ia,rt as zo,tt as Wo,ue as _i,zf as qi}from"https://app.framerstatic.com/chunk-MEZTIH57.mjs";import"https://app.framerstatic.com/chunk-VXJAAVJQ.mjs";import{e as na}from"https://app.framerstatic.com/chunk-6C6VSETA.mjs";import"https://app.framerstatic.com/chunk-FYUJQV6J.mjs";import"https://app.framerstatic.com/chunk-KYPY4QS7.mjs";import"https://app.framerstatic.com/chunk-VYKXUNIW.mjs";import"https://app.framerstatic.com/chunk-R3NZHMAQ.mjs";import{K as ft,n as Ai,x as Di,y as Bi}from"https://app.framerstatic.com/chunk-4PXICH4C.mjs";import{a as oa,b as W}from"https://app.framerstatic.com/chunk-QLLZMBTC.mjs";import"https://app.framerstatic.com/chunk-XFC6OVIX.mjs";import"https://app.framerstatic.com/chunk-4I3XDWXC.mjs";import{a as B,b as Ti}from"https://app.framerstatic.com/chunk-YSH2VGR3.mjs";import"https://app.framerstatic.com/chunk-LKMP537Z.mjs";import{a as yt}from"https://app.framerstatic.com/chunk-7GSEC7H4.mjs";import"https://app.framerstatic.com/chunk-PRTO6OS3.mjs";import{c as Ni}from"https://app.framerstatic.com/chunk-J54NYYQ5.mjs";import"https://app.framerstatic.com/chunk-POQKH4YA.mjs";import{e as va,g as ba,i as ye}from"https://app.framerstatic.com/chunk-N4S37JPH.mjs";import"https://app.framerstatic.com/chunk-AUNF3KWQ.mjs";import{p as ge,r as jt}from"https://app.framerstatic.com/chunk-XB2V7G5R.mjs";import"https://app.framerstatic.com/chunk-JFRKIM2Y.mjs";import{b as z,d as Io,e as mt,f as Ro,i as Se,m as en,o as Oi}from"https://app.framerstatic.com/chunk-ZQUNXESX.mjs";import{Bc as Ri,a as oe,ad as Xe,b as U}from"https://app.framerstatic.com/chunk-JX6NUTD4.mjs";import"https://app.framerstatic.com/chunk-TL2YQ7KN.mjs";import{f as Ei}from"https://app.framerstatic.com/chunk-XDXIFLRG.mjs";import{F as Si,ea as ho,fa as Ht,j as Ao,m as le,p as Do}from"https://app.framerstatic.com/chunk-WWEGIMHT.mjs";import{a as p,b as Wt}from"https://app.framerstatic.com/chunk-WNSBRACC.mjs";import{a as Bo}from"https://app.framerstatic.com/chunk-LQILWJHN.mjs";import{e as y,f as ne,g as ie,h as C,i as S,j as I,k as zt,l as N,m as No}from"https://app.framerstatic.com/chunk-AHQIRSXG.mjs";var ec=y(U()),rm={BooleanControlPropRow:yr,EnumControlPropRow:xo,StringControlPropRow:Po};function Ql({children:r}){return(0,ec.jsx)(al.Provider,{value:rm,children:r})}var wn="data-chrome";function tc(r){return r instanceof HTMLElement?r.closest(`[${wn}]`)!==null:!1}var Cn="data-floating-canvas-chrome";function oc(r){return r instanceof Element?r.closest(`[${Cn}]`)!==null:!1}function rc(){return window}function xn(){return rc().secureFrameAncestors}function eo(){B(xn(),"Must have secure frame ancestors.")}var Br=y(oe());var nc="c1gxt05z",ic="n1sd5akc";var Nt=y(oe());var Pn=y(U());function ac({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,F)[t];return B(l?.type==="boolean"),(0,Pn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,Pn.jsx)(Rl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:c=>{ce(c)&&i(t,c)}})})}var sc="o1kosemn",lc="o1tcokht",cc="o11jr4ka",im=1,dc=ye.panelPadding+im,fc="oaqx903",hr="b1gqim6f";var mc="wje69dc",pc="i1rqgchl",uc="ixghur2",gc="c1d0unc6";var Fn=y(U());function yc({collectionNode:r,controlProp:o,variableId:e,warningMessage:t,onChange:n}){let i=W(),s=r.getPropertyControls(i.tree,F)[e];B(s?.type==="collectionreference");let l=Qi(s,o);B(!O(l),"Variables are not supported");let c=s.dataIdentifier;function m(d){n(e,{type:"collectionreference",value:d})}return(0,Fn.jsx)(H,{title:s.title??"",warningMessage:t,children:(0,Fn.jsx)(Il,{large:!0,value:l,onChange:m,className:pc,dataIdentifier:c,wrapperClassName:Gi(mc,gc),iconClassName:uc})})}var vn=y(U());function hc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,F)[t];return B(l?.type==="color"),(0,vn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,vn.jsx)(Ol,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:c=>{ce(c)&&i(t,c)},ColorPickerPopoutComponent:il})})}var bn=y(U());function Ic({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,F)[t];return B(l?.type==="date"),(0,bn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,bn.jsx)(Ml,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:c=>{ce(c)&&i(t,c)},required:!1})})}var Sn=y(U());function Uc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,F)[t];return B(l?.type==="enum"),(0,Sn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,Sn.jsx)(Vl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:c=>{ce(c)&&i(t,c)}})})}var En=y(U());function wc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,F)[t];if(B(l?.type==="file"),B(!Le(e?.value),"Dynamic values are not supported within required field validation"),e&&e?.type!=="file")return null;let m=(e?.value??"").split(".").pop(),d=!m||l.allowedFileTypes.length===0||l.allowedFileTypes.includes(m);return(0,En.jsx)(H,{title:l.title??"",warningMessage:n,showWarningTint:!d,children:(0,En.jsx)(Ll,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:u=>{ce(u)&&i(t,u)},reset:()=>{i(t,{type:"file",value:void 0})}})})}var Tn=y(U());function Cc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,onChange:n}){let i=W(),a=Ws(g=>{let f=g(e);f&&n(t,f)}),l=o.getPropertyControls(i.tree,F)[t];B(l?.type==="array"),B(!e||$i(e));let c=$s(e,l,!0),m=Xs(e,l,!0),u=fr(c??m,l);return(0,Tn.jsx)(H,{title:l.title??"",warningMessage:u,children:(0,Tn.jsx)(zl,{collectionId:o.id,control:l,fieldId:t,controlProp:e,itemId:r.id,onChange:a,required:!1})})}var Nn=y(U());function xc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,F)[t];return B(l?.type==="responsiveimage"),(0,Nn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,Nn.jsx)(Wl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:c=>{let m=c(e);ce(m)&&i(t,m)},reset:()=>{let c={type:"image",value:void 0};i(t,c)}})})}var An=y(U());function Pc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,F)[t];return B(l?.type==="link"),(0,An.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,An.jsx)(Hl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:c=>{ce(c)&&i(t,c)},reset:()=>{let c={type:"link",value:void 0};i(t,c)}})})}var Fc="i4uywus";var Dn=y(U());function vc({collectionNode:r,controlProp:o,variableId:e,warningMessage:t,onChange:n}){let i=W(),s=r.getPropertyControls(i.tree,F)[e];p(s?.type==="multicollectionreference");let l=s.dataIdentifier,c=ea(s,o)??[];return p(!O(c),"Variables are not supported"),(0,Dn.jsx)(H,{title:s.title??"",warningMessage:t,children:(0,Dn.jsx)(Al,{large:!0,value:c,onChange:m=>{n(e,{type:"multicollectionreference",value:m})},wrapperClassName:Fc,dataIdentifier:l})})}var Bn=y(U());function bc({collectionItemNode:r,collectionNode:o,controlProp:e,variableId:t,warningMessage:n,onChange:i}){let a=W(),l=o.getPropertyControls(a.tree,F)[t];return B(l?.type==="number"),(0,Bn.jsx)(H,{title:l.title??"",warningMessage:n,children:(0,Bn.jsx)(jl,{control:l,controlProp:e,fieldId:t,itemId:r.id,onChange:c=>{ce(c)&&i(t,c)}})})}var Ir=y(U()),Sc=["left","right","auto-vertical"];function Ec({collectionNode:r,collectionItemNode:o,controlProp:e,variableId:t,onChange:n,warningMessage:i}){let a=W(),l=r.getPropertyControls(a.tree,F)[t];p(l?.type==="richtext");let c=e&&Ni(e.value)?e.value:void 0,m=g=>{n(t,{type:l.type,value:g})},d=pr(()=>ut(Wo)),u=jt("pasteMarkdown");return(0,Ir.jsx)(H,{title:l.title??"",warningMessage:i,children:u?(0,Ir.jsx)(ur,{enabled:!0,schema:d,compactTagSelector:!0,defaultValue:c??"",onChange:m,scopeType:"ContentManagement",onUnsavedChange:yt,popoverAttachmentEdge:Sc,fallbackToModalAppearance:!0,saveOnMetaArrowNavigation:!0},o.id):(0,Ir.jsx)(gr,{enabled:!0,supportsEmbeds:!0,supportsMedia:!0,compactTagSelector:!0,defaultValue:c??"",onChange:m,scopeType:"ContentManagement",onUnsavedChange:yt,popoverAttachmentEdge:Sc,fallbackToModalAppearance:!0,saveOnMetaArrowNavigation:!0},o.id)})}var Ur=y(U());function Tc({collectionNode:r,collectionItemNode:o,controlProp:e,variableId:t,onChange:n,warningMessage:i}){let a=W(),l=r.getPropertyControls(a.tree,F)[t];p(l?.type==="string");let c=e&&z(e.value)?e.value:void 0,m=l.placeholder,d=l.defaultValue??"",u=c??d,g=f=>{n(t,{type:l.type,value:f})};return(0,Ur.jsx)(H,{title:l.title??"",warningMessage:i,children:l.displayTextArea?(0,Ur.jsx)(za,{value:u,onChange:g,constantChange:!0,placeholder:m,minRows:10,maxRows:30,className:ql},o.id):(0,Ur.jsx)(Wa,{type:l.obscured?"password":"text",value:u,onChange:g,placeholder:m,constantChange:!0,className:kl})})}var k=y(U());function Ac({fieldIdsToShow:r,requiredFieldsOnly:o,collectionItemId:e,collectionNodeId:t}){let[n,i]=(0,Nt.useState)(!0),[a,s]=(0,Nt.useState)(()=>new Map),l=a.size>0,c=x(),{treeStore:m,projectStore:d,modalStore:u}=c.stores,g=e!==c.stores.canvasStore.temporaryCollectionItemNodeId,f=m.tree.getNodeWithTrait(t,_t),w=m.tree.getNodeWithTrait(e,Ze);(0,Nt.useEffect)(()=>{(!w||!f||w.parentid!==f.id)&&u.dismiss()},[w,f,u]);let h=o||g,P=()=>{for(let[Q,M]of a)m.tree.current(w)?.setControlProp(Q,M);h?g?(m.tree.current(w)?.set({privateToUserId:void 0}),d.commitTreeAndSend()):c.stores.canvasStore.saveTemporaryCollectionItem():d.commitTreeAndSend(),u.dismissAll()},A=()=>{if(!sr()){if(g&&b.size>0){i(!1);return}P()}},b=dm({collectionNode:f||void 0,collectionItemNode:w||void 0,tempControlProps:a,fieldIdsToShow:r});function q(Q){let R=f?.getPropertyControls(m.tree,F)?.[Q];if(!R)return;let tt=b.get(Q);if(!(tt?.type==="required"&&!(g&&!n)))return fr(tt,R)}let K=(Q,M)=>{p(w,"CollectionItemNode must be present");let R=w.getControlProp(Q);s(tt=>R?.value===M.value?ho.remove(tt,Q):Ro(R?.value)&&Ro(M.value)&&Fs(R.value,M.value)?ho.remove(tt,Q):Nc(R)&&Nc(M)?ho.remove(tt,Q):ho.set(tt,Q,M))},se=()=>{if(!l){Ke();return}u.push({type:"Confirmation",title:"Unsaved Changes",description:"Are you sure that you want to discard your new item?",interactionRequired:!0,onConfirm:()=>Ke(),cancelLabel:"Continue Editing",confirmLabel:"Discard Item",dismissVariant:"primary",variant:"destructiveSecondary",cancelOnEnter:!0,confirmOnEnter:!1,source:"on_page_hud",buttonDirection:"column",hasBackdrop:!0})},Ke=()=>{w&&(m.tree.remove(w.id),d.commitTreeAndSend(),u.dismiss())},Ve=()=>{if(g){se();return}if(o){u.dismiss();return}P()},Ge=()=>{if(g){se();return}u.dismiss()};return(0,k.jsxs)(Yt,{hasBackdrop:!0,className:sc,visible:r.length>0,onDismiss:Ve,onConfirm:A,children:[(0,k.jsx)($t,{separator:!0,title:g?"New Item":o?"Required Fields":"All Fields",className:lc,children:(0,k.jsx)(Xt,{onDismiss:Ge})}),(0,k.jsxs)(Xa,{className:cc,children:[(0,k.jsx)(qa,{size:0}),r.map(Q=>{if(!f||!w)return null;let M=f.getVariable(Q);if(!M)return null;let R=a.get(Q)??w.getControlProp(Q);return(0,k.jsx)(cm,{variable:M,collectionItemNode:w,collectionNode:f,controlProp:R,onChange:K,getWarningMessage:q},Q)})]}),(0,k.jsx)(Xo,{displayDivider:!1,paddingTop:dc,className:fc,children:(0,k.jsxs)(Sa,{children:[o?(0,k.jsx)(G,{bold:!0,onClick:Ge,className:hr,children:(0,k.jsx)(rt,{children:"Cancel"})}):(0,k.jsx)(G,{bold:!0,onClick:Ge,className:hr,children:(0,k.jsx)(rt,{children:l?"Discard":"Cancel"})}),(0,k.jsx)(G,{bold:!0,type:"submit",variant:"primary",className:hr,enabled:o?b.size===0:l,children:(0,k.jsx)(rt,{children:"Save"})})]})})]})}function cm({variable:r,collectionItemNode:o,collectionNode:e,controlProp:t,onChange:n,getWarningMessage:i}){let a=r.type;switch(a){case"slug":return wo(r)?(0,k.jsx)(_l,{collectionNode:e,collectionItemNode:o,controlProp:t,onChange:n,variable:r,warningMessage:i(r.id)}):null;case"string":return(0,k.jsx)(Tc,{collectionNode:e,collectionItemNode:o,controlProp:t,variableId:r.id,onChange:n,warningMessage:i(r.id)});case"richtext":return(0,k.jsx)(Ec,{collectionNode:e,collectionItemNode:o,controlProp:t,variableId:r.id,onChange:n,warningMessage:i(r.id)});case"link":return(0,k.jsx)(Pc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"image":return(0,k.jsx)(xc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"array":return(0,k.jsx)(Cc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,onChange:n});case"multicollectionreference":return(0,k.jsx)(vc,{collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"collectionreference":return(0,k.jsx)(yc,{collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"file":return(0,k.jsx)(wc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"date":return(0,k.jsx)(Ic,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"number":return(0,k.jsx)(bc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"boolean":return(0,k.jsx)(ac,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"enum":return(0,k.jsx)(Uc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});case"color":return(0,k.jsx)(hc,{collectionItemNode:o,collectionNode:e,controlProp:t,variableId:r.id,warningMessage:i(r.id),onChange:n});default:Ti(a)}}function dm({collectionNode:r,collectionItemNode:o,tempControlProps:e,fieldIdsToShow:t}){let n=x(),i=v(()=>n.stores.treeStore.tree,[]),a=Ys(r,o);return(0,Nt.useMemo)(()=>{let s=new Map;if(!r||!o)return s;for(let l of t){let c=r.getVariable(l);if(!c)continue;let d=r.getPropertyControls(i,F)[l];if(!d)continue;let u=e.get(l)??o.getControlProp(l),g=a.get(l),f;(Vo(c)||wo(c))&&(f=cr(c,r.variables,o));let w=dr(c.type,d,u,f,void 0,Lo(c),g);w&&s.set(l,w)}return s},[r,o,t,a,i,e])}function Nc(r){return!r||Oi(r.value)?!0:z(r.value)?as(r.value):Ro(r.value)?r.value.length===0:!1}var Cr=y(oe());var Dc="e1zu74n";var Rc=y(U());function Bc({initialHtml:r,onContentChange:o,onEscape:e}){let t=(0,Cr.useRef)(null);return(0,Cr.useEffect)(()=>{let n;async function i(){let{baseKeymap:a,chainCommands:s,dropCursor:l,gapCursor:c,history:m,keymap:d,redo:u,undo:g,undoInputRule:f}=await Zt(),w=ge.isOn("pasteMarkdown")?(q,K,se)=>_o(q,K,se):(q,K,se)=>qo(q,se),h=ut(zo),P=w(r,h,{plugins:[m(),d({"Mod-z":s(f,g),"Mod-Shift-z":u,"Shift-Enter":rr(h),"Mod-b":hn(h.marks.bold),"Mod-i":hn(h.marks.italic),"Shift-Tab":fs(h.nodes.listItem),Tab:s(ms(h.nodes.listItem),()=>!0),Backspace:s(f,nr(h)),Escape:()=>(e?.(),!!e)}),d(a),l({color:"var(--framer-color-text)",width:2}),c(),ir()]}),A,b=new na(null,{state:P,editable:()=>!0,dispatchTransaction:q=>{let K=b.state.apply(q);if(b.updateState(K),A!==K.doc){let se=ge.isOn("pasteMarkdown")?Ho(K.doc,h):jo(K.doc);o(se),A=K.doc}}});t.current&&(t.current.innerHTML="",t.current.appendChild(b.dom)),n=b}return i(),()=>n?.destroy()},[r,o,e]),(0,Rc.jsx)("div",{ref:t,className:Dc})}function st({tree:r,webPageNodeId:o}){let e=r.getNodeWithTrait(o,_i);if(e?.loaded)return e.loaded;e?.load().catch(le)}function pe({screenWidth:r,tree:o,webPageNodeId:e}){let n=st({tree:o,webPageNodeId:e})?.getBreakpointValues(),i=Ji(n,r);return o.get(i)}function Je(r,o,e){let t=e.temporaryCollectionItemNodeId??r.collectionItemNodeId;return o.tree.getNodeWithTrait(t,Ze)??void 0}function to(r,o,e){let t=Je(r,o,e);if(t)return o.tree.getNodeWithTrait(t.parentid,_t)??void 0}function ze(r){return window.editorBarFeatures[r]===!0}var Z=class{constructor(o){this.engine=o;I(this,"scheduler");this.scheduler=o.scheduler}};function At(r,o,e){let t=e(o.id),i=cs(o,r).find(s=>s.keyPath===t);if(i)return i;if(!o.originalid)return;let a=r.tree.getNode(o.originalid);if(a)return At(r,a,e)}function lt(r,o){let e=pt(r.tree,r.stores.routeStore.localeId);return e&&ze("onPageLocalizationSupport")&&e.id!==qt?Gt(e,o.valueLocalized):null}function oo(r,o,e){let t=r.tree.root.getLocale(r.stores.routeStore.localeId),n=o.value;p(z(n),"Control prop value must be a string");let i=lt(r,o);if(i&&t?.id!==qt){let a=nt(i.value),s=Qo(a,i,n);if(s)return e?Pt(n,s.value):s.type==="rich-text"?Jo(n,s.value):Pt(n,s.value)}return n}function xr(r,o,e,t){let{controlProp:n,collectionItemNode:i}=o,s=lt(r,n)?.value??n.value,l=r.tree.root.getLocale(r.stores.routeStore.localeId);if(p(l.id!==qt,"Active locale must be a non-default locale"),!z(s)){r.exitTool();return}let c=Pt(s,e),m=At(r,t,()=>or(i.id,o.variableId,void 0));p(m,"There must be a localization source for updating a localized value");let d=Ft(c);Et(r,d,m,l,{trackingSource:"on-page-rich-text-edit-tool"})}function ro(r,o,e,t,n,i){let a=At(r,o,i);if(!a){r.exitTool();return}let l=nt(e)==="rich-text"?er(t):Ft(t);Et(r,l,a,n,{trackingSource:"on-page-rich-text-edit-tool"})}var mm=/^(?<hashes>#{1,6})\s$/u,he=class r extends Z{constructor(e,t,n,i="none"){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i;I(this,"handleOnFocus",()=>this.proseMirrorEditor?.controls.handleOnFocus());I(this,"handleOnBlur",()=>this.proseMirrorEditor?.controls.handleOnBlur());I(this,"proseMirrorEditor",null);I(this,"hasTextFitViewBox",!1);I(this,"isEditingPlainTextLocalizedValue");this.engine.beginUndoGroup();let a=this.getRichTextNode();if(a){let s=nt(a.html),c=this.engine.stores.routeStore.localeId!==re&&s!=="rich-text";this.isEditingPlainTextLocalizedValue=c}this.start()}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,E)}update(){let e=this.getRichTextNode();if(!e||!r.supportsNode(this.engine,e)){this.engine.exitTool();return}let t=this.engine.stores.routeStore.localeId,n=nt(e.html),i=t!==re&&n!=="rich-text";if(this.isEditingPlainTextLocalizedValue!==void 0&&i!==this.isEditingPlainTextLocalizedValue){this.engine.exitTool();return}if(!e.textFitViewBoxSize||this.hasTextFitViewBox)return;let a=Ua(this.engine.tree,e);this.engine.stores.projectStore.commitTreeAndSend(),a&&(this.hasTextFitViewBox=!0)}async stop(){let e=this.getRichTextNode();e&&(e.cache.isEditable=!1),this.proseMirrorEditor?.destroy(),this.proseMirrorEditor=null,this.engine.endUndoGroup(),this.engine.stores.toolStore.proseMirrorView=null,this.engine.stores.toolStore.nodeInTextEditorId=null}start(){let e=this.getRichTextNode();if(!e)return;this.hasTextFitViewBox=ya(this.engine.tree,e),this.engine.stores.projectStore.commitTreeAndSend();let t=ar(this.engine.tree,e);if(t.length===0){this.init();return}ft.loadFonts(t).catch(le).finally(()=>this.init())}init(){this.startAsync().catch(e=>{le(e),this.engine.exitTool()})}async startAsync(){let e=this.getRichTextNode();if(!e)return this.engine.exitTool();this.proseMirrorEditor=await this.createProseMirrorEditor(e),e.cache.isEditable=!0,this.engine.stores.toolStore.proseMirrorView=this.proseMirrorEditor.view}async createProseMirrorEditor(e){let{baseKeymap:t,chainCommands:n,createParagraphNear:i,Decoration:a,DecorationSet:s,dropCursor:l,EditorView:c,ellipsis:m,emDash:d,gapCursor:u,history:g,InputRule:f,inputRules:w,keymap:h,liftEmptyBlock:P,liftListItem:A,newlineInCode:b,redo:q,sinkListItem:K,splitBlock:se,splitListItem:Ke,toggleMark:Ve,undo:Ge,undoInputRule:Q}=await Zt(),M=this.engine,R=ut(zo),tt=n(Ke(R.nodes.listItem),b,i,P,us(R),ps(R),(te,Y)=>se(te,Y&&($=>{let ve=te.selection,Ye=this.getRichTextNode();p(Ye,"RichTextNode not found");let $e=ve.$from.node(1);if(!cn($e)||!(ve.$to.parentOffset===ve.$to.parent.content.size))return Y($);let be={...$e.attrs},xt=ln($e)&&be.tag!=="p",yo=$.mapping.map(te.selection.to),Lt=te.selection.$from.marks();if(xt){let ot=Ye.getNodeTextStylePreset(M.tree,"p")??mn(M.tree,"p")??dn.createDefault("p");pn(M,ot),Ye.setNodeTextStylePreset(ot),M.stores.projectStore.commitTreeAndSend(),be.textStylePreset=ot.id,be.tag="p",be.inlineStyles={},be.blockStyles={}}else{let ot=Lt.find(ta);be.inlineStyles={...be.inlineStyles,...ot?.attrs.inlineStyles}}$.setNodeMarkup(yo-1,void 0,be),$.setStoredMarks(Lt),xt&&$.removeStoredMark(R.marks.inlineStyles),Y($)})));function Pi(){return M.exitTool(),!0}p(!O(e.htmlContent),"Can't edit rich text node when htmlContent variable is assigned"),p(!O(e.textContent),"Can't edit rich text node when textContent variable is assigned");let Qr=()=>{let te=this.getRichTextNode();p(te,"RichTextNode not found");let Y=te.getNodeInlineCodeStylePreset(M.tree)??ua(M.tree)??new ma;return ga(M,Y),te.setNodeInlineCodeStylePreset(Y),Y.id},Fi=ge.isOn("pasteMarkdown")?(te,Y,$)=>_o(te,Y,$):(te,Y,$)=>qo(te,$),om=um(M,e),vi=Fi(om,R,{plugins:[g(),h({"Mod-z":n(Q,Ge),"Mod-Shift-z":q,"Shift-Enter":rr(R),...this.isEditingPlainTextLocalizedValue?{}:{"Mod-b":Ve(R.marks.bold),"Mod-i":Ve(R.marks.italic)},"Shift-Tab":A(R.nodes.listItem),Tab:n(K(R.nodes.listItem),()=>!0),Backspace:n(Q,nr(R)),Escape:Pi,Enter:tt,"Mod-Shift-c":Ve(R.marks.inlineCode,{get inlineCodeStylePreset(){return Qr()}})}),h(t),l({color:ba.cmsRichTextDropCursor,width:ye.richTextDropCursor}),u(),ir(),ws({engine:this.engine,schema:R,nodeId:this.nodeId,getRichTextNode:()=>this.getRichTextNode()}),w({rules:[d,m,new f(mm,(te,Y,$,ve)=>{let Ye=te.doc.resolve($),$e=Ye.node(1),To=Ye.before(1);if(!cn($e))return null;let be=te.tr,xt="h"+(Y.groups?.hashes?.length||1),yo=this.getRichTextNode();p(yo,"RichTextNode not found");let Lt=yo.getNodeTextStylePreset(M.tree,xt)??mn(M.tree,xt)??dn.createDefault(xt),ot=Lt.id;return pn(M,Lt),yo.setNodeTextStylePreset(Lt),M.stores.projectStore.commitTreeAndSend(),ln($e)||be.removeMark(To,To+$e.nodeSize,R.marks.inlineStyles),be.delete($,ve),be.setNodeMarkup(To,R.nodes.textBlock,{...$e.attrs,blockStyles:ot?{}:$e.attrs.blockStyles,inlineStyles:ot?{}:$e.attrs.inlineStyles,textStylePreset:ot,tag:xt}),be}),gs(R),ys(R)]}),...ds({markType:R.marks.inlineCode,attrs:{get inlineCodeStylePreset(){return Qr()}}})]}),bi,dt=new c(null,{state:vi,dispatchTransaction:te=>{let Y=M.tree.root.getLocale(M.stores.routeStore.localeId),$=this.getRichTextNode();p($,"Node should not be null");let ve=dt.state.apply(te);if(dt.updateState(ve),ve=ha(ve,dt,$),bi!==ve.doc){let Ye=ge.isOn("pasteMarkdown")?Ho(ve.doc,R):jo(ve.doc);$.html!==Ye&&(Y&&Y.id!==re&&ze("onPageLocalizationSupport")?ro(M,$,$.html,Ye,Y,ss):r.updateNodeWithBreakpointAwareness({engine:this.engine,html:Ye,node:$}),Ia($,dt)),bi=ve.doc}this.engine.stores.projectStore.commitTreeAndSend()}});return{controls:{handleOnFocus(){dt.setProps({decorations(){}})},handleOnBlur(){dt.setProps({decorations(te){let Y=te.selection;if(Y.from!==Y.to)return document.getSelection()?.removeAllRanges(),s.create(te.doc,[a.inline(Y.from,Y.to,{class:"selection",nodeName:"mark"})])}})}},destroy:()=>dt.destroy(),state:vi,view:dt}}static updateNodeWithBreakpointAwareness({engine:e,node:t,html:n,breakpointNode:i}){let{tree:a,stores:s}=e,{routeStore:l,canvasStore:c,treeStore:m}=s;i??=pe({screenWidth:c.screenWidth,tree:m.tree,webPageNodeId:l.webPageNodeId});let d=t.getPrimaryId(),u=!zi(i)||Xi(i)||!d,g=!Ko(a,t,"html"),f=a.getNodeWithTrait(d,E);if(p(f,`originalNode with id ${d} must exist`),u||g){f.set({html:n});return}if(t.getTextContent()===f.getTextContent()){f.set({html:Pt(f.html,Ft(n))});return}t.set({html:n},a,!1,!1)}static supportsNode(e,t){return!E(t)||e.tree.root.getLocale(e.stores.routeStore.localeId).id!==re&&t.textFitViewBoxSize?!1:!t.htmlContent&&!t.textContent}};function pm(r,o){let e=pt(r.tree,r.stores.routeStore.localeId);return e&&o.htmlLocalized&&ze("onPageLocalizationSupport")?Gt(e,o.htmlLocalized):null}function um(r,o){let e=pm(r,o);if(e){let t=nt(o.html),n=Qo(t,e,o.html);return n?n.type==="rich-text"?Jo(o.html,n.value):Pt(o.html,n.value):o.html}return o.html}function Ie(){let r=x();return v(()=>st({tree:r.stores.treeStore.tree,webPageNodeId:r.stores.routeStore.webPageNodeId}),[])}function kc(){let r=x(),{routeStore:o,treeStore:e,canvasStore:t}=r.stores;return it(()=>Je(o,e,t),[],[o,e,t])}function Oc(){let r=x(),{routeStore:o,treeStore:e,canvasStore:t}=r.stores;return it(()=>to(o,e,t),[],[o,e,t])}var Te=y(oe());var Mc="m168h77v";var Ue=y(U());function Vc({richTextNodeId:r}){let o=x(),e=Ie(),[t,n]=(0,Te.useState)(()=>{let f=pe({screenWidth:o.stores.canvasStore.screenWidth,tree:o.stores.treeStore.tree,webPageNodeId:o.stores.routeStore.webPageNodeId});return p(f,"activeOnPageBreakpointNode must exist"),f.id}),i=(0,Te.useRef)(new Map),a=(0,Te.useMemo)(()=>{let f=o.stores.treeStore.tree.getNodeWithTrait(r,E);return f?f.getPrimaryId():r},[r]),s=(0,Te.useCallback)(()=>o.stores.scopeStore.active.getTopLevelReplicaVariants().find(({id:f})=>t===f),[t]),l=(0,Te.useCallback)(()=>{let f=s();if(!f)return;let w=Co(f.id,a),h=o.stores.treeStore.tree.get(w);return E(h)?h:void 0},[s,a]),c=v(()=>o.stores.scopeStore.active.getPrimaryVariant().id,[]),m=(0,Te.useMemo)(()=>{let f=i.current.get(t);if(f!==void 0)return f;if(t===c){let w=o.stores.treeStore.tree.getNodeWithTrait(a,E);return p(w,"originalNode should exist"),w.html}return l()?.html??""},[l,c,t,a]),d=(0,Te.useCallback)(f=>i.current.set(t,f),[t]),u=(0,Te.useCallback)(()=>{o.exitTool(),o.stores.modalStore.dismiss()},[]),g=(0,Te.useCallback)(()=>{let f=o.stores.scopeStore.active.getPrimaryVariant(),w=i.current.get(f.id);if(w!==void 0){let h=o.stores.treeStore.tree.getNodeWithTrait(a,E);p(h,`originalNode with id ${a} must exist`),h.html!==w&&h.set({html:w})}o.stores.scopeStore.active.getTopLevelReplicaVariants().forEach(h=>{let P=i.current.get(h.id);if(P===void 0)return;let A=Co(h.id,a),b=o.stores.treeStore.tree.get(A);E(b)&&b.html!==P&&he.updateNodeWithBreakpointAwareness({breakpointNode:h,engine:o,html:P,node:b})}),i.current.clear(),o.stores.projectStore.commitTreeAndSend(),u()},[u,a]);return(0,Ue.jsxs)(Yt,{visible:!0,hasBackdrop:!0,onDismiss:u,className:Mc,children:[(0,Ue.jsx)($t,{separator:!0,title:"Responsive Text",children:(0,Ue.jsx)(Xt,{onDismiss:u})}),(0,Ue.jsxs)(Ee,{gap:ye.inputSpacing,paddingTop:ye.modalPadding,children:[(0,Ue.jsx)($a,{children:e?.getTopLevelVariants().map(f=>(0,Ue.jsx)(Ya,{identifier:f.id,title:f.resolveValue("name")??f.id,selected:t===f.id,onSelect:n},f.id))}),(0,Ue.jsx)(Bc,{initialHtml:m,onContentChange:d,onEscape:u})]}),(0,Ue.jsxs)(Xo,{displayDivider:!0,children:[(0,Ue.jsx)(G,{bold:!0,onClick:u,variant:"default",children:(0,Ue.jsx)(rt,{children:"Cancel"})}),(0,Ue.jsx)(G,{bold:!0,onClick:g,variant:"primary",children:(0,Ue.jsx)(rt,{children:"Save"})})]})]})}var we=class r extends Z{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i;I(this,"controls");this.engine.beginUndoGroup(),Zt().then(a=>{e.stores.toolStore.proseMirror??=a})}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,E)}getVariableReference(){let e=this.getRichTextNode();if(!e)return;let t=e.htmlContent;if(O(t))return t}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=this.getVariableReference();if(n)return V(this.engine.tree,this.engine.stores.treeStore.sandboxCollectionData,n,"richtext",t.collectionItemId)}getValue(){let e=this.getVariableInfo();if(!e)return;let{controlProp:t}=e;return p(t,"Control prop must exist"),oo(this.engine,t)}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,variableDefinition:i,controlProp:a}=t;p(a,"Control prop must exist");let s=this.engine.tree.root.getLocale(this.engine.stores.routeStore.localeId);if(s.id!==re){let c=lt(this.engine,a)?.value??a.value;if(!z(c)){this.engine.exitTool();return}r.updateLocalizedValue(this.engine,n,i.id,c,e,s)}else{if(a.value===e)return;n.setControlProp(i.id,{...a,value:e})}this.engine.stores.projectStore.commitTreeAndSend()}static updateLocalizedValue(e,t,n,i,a,s){let l=At(e,t,()=>or(t.id,n,void 0));p(l,"There must be a localization source for updating a localized value");let m=nt(i)==="rich-text"?er(a):Ft(a);Et(e,m,l,s,{trackingSource:"on-page-rich-text-edit-tool"})}update(){let e=this.engine,t=this.getRichTextNode();if(!t||!r.supportsNode(e,t,this.renderId))e.exitTool();else{let n=this.getVariableInfo();this.engine.stores.toolStore.validateCollectionControl(n)}}stop(){this.engine.endUndoGroup(),this.engine.stores.toolStore.nodeInTextEditorId=null}static supportsNode(e,t,n){if(!E(t)||!O(t.htmlContent))return!1;let i=t.cache.getRenderInstance(n);return i?!!V(e.tree,e.stores.treeStore.sandboxCollectionData,t.htmlContent,"richtext",i.collectionItemId):!1}};var Pr=y(oe());var Lc="m1cvfiap",zc="f1nz04q2",Wc="syo0l7n",Hc="w9541mz",Rn="e73gufq";var It=y(U()),jc=["left","right","auto-vertical"];function _c({controlKey:r,nodeId:o}){let e=x(),t=()=>{e.stores.modalStore.dismiss()},n=it(()=>{let g=e.stores.treeStore.tree.get(o);return!Ze(g)&&!Be(g)?null:g},[o],["Tree"]),i=it(()=>{let u=e.tree.getScopeNodeFor(n);return u?es(u):null},[n],["Tree"]),a=it(()=>{if(Ze(n)){let u=n?.parentid,g=e.stores.treeStore.tree,f=g.getNodeWithTrait(u,_t);if(!f)return null;let h=f.getPropertyControls(g,F)[r];return h?.type==="richtext"?h:null}if(Be(n)){let u=F.reactComponentForIdentifier(n.codeComponentIdentifier);if(!u)return null;let g=u.properties[r];return g?.type==="richtext"?g:null}return null},[r,n],["Tree","ActiveBundle"]),s=(0,Pr.useMemo)(()=>{if(!n)return"";let u=kn(n,r);return u?oo(e,u):""},[n,r]),l=!!i&&!!n&&a?.type==="richtext",c=u=>{if(!n)return;let g=e.stores.treeStore.tree.current(n);if(!g)return;let f=e.tree.root.getLocale(e.stores.routeStore.localeId);if(f.id!==re){if(Ze(g)){let P=g.getControlProp(r);if(!P||P.type!=="richtext")return;let b=lt(e,P)?.value??P.value;if(!z(b)){e.stores.modalStore.dismiss();return}we.updateLocalizedValue(e,g,r,b,u,f);return}if(Be(g)){let P=kn(g,r);if(!P||!z(P.value)){e.stores.modalStore.dismiss(),e.exitTool();return}ro(e,g,P.value,u,f,A=>tr(A,r,void 0));return}}let w,h=kn(n,r);h?w={...h,value:u}:w={type:"richtext",value:u},Ze(g),g.setControlProp(r,w),p(Fa(e),"Only on-page engine can commit tree"),e.stores.projectStore.commitTreeAndSend()};(0,Pr.useEffect)(()=>{l||e.stores.modalStore.dismiss()},[l]);let m=pr(()=>ut(Mo(n)?Wo:ia)),d=jt("pasteMarkdown");return l?(0,It.jsxs)(Yt,{visible:!0,hasBackdrop:!0,onDismiss:t,className:Lc,formClassName:zc,children:[(0,It.jsx)($t,{separator:!0,title:a.title??"Unknown",className:Hc,children:(0,It.jsx)(Xt,{onDismiss:t})}),(0,It.jsx)(Ha,{className:Wc,children:d?(0,It.jsx)(ur,{enabled:!0,schema:m,className:Rn,defaultValue:s,onChange:c,scopeType:i,onUnsavedChange:yt,popoverAttachmentEdge:jc,fallbackToModalAppearance:!0,saveOnMetaArrowNavigation:!0}):(0,It.jsx)(gr,{enabled:!0,supportsEmbeds:Mo(n),supportsMedia:Mo(n),className:Rn,defaultValue:s,onChange:c,scopeType:i,onUnsavedChange:yt,popoverAttachmentEdge:jc,fallbackToModalAppearance:!0,saveOnMetaArrowNavigation:!0})})]}):null}function kn(r,o){if(Ze(r)){let e=r.getControlProp(o);return e?.type==="richtext"&&z(e.value)?e:null}if(Be(r)){let e=F.reactComponentForIdentifier(r.codeComponentIdentifier);if(!e)return null;let n=r.getControlProps(e.properties)[o];if(n?.type==="richtext"&&z(n.value))return n}return null}var Fo=y(U()),hm={AcquireAddonModal:null,AcquireAdvancedAnalyticsTrialModal:null,AddToLibrary:null,BatchTranslate:null,CodeFileCreation:null,CompleteSignup:null,ComponentIsolationModal:null,Confirmation:Sl,ConfirmBatchTranslateAll:null,ConfirmDefaultLanguage:null,ConfirmDeleteCollectionItems:null,ConfirmDeleteCustomCode:null,ConfirmDestructiveFeedbackAction:null,ConfirmDraftCollectionItem:null,ConfirmDraftLocale:null,ConfirmDraftPage:null,ConfirmPublishAbTest:null,ConfirmPublishDraftCollectionItem:null,ConfirmPublishDraftLocale:null,ConfirmPublishDraftPage:null,ConfirmRemoveTriggerEvent:null,ConfirmUpdatingAbVariants:null,ConvertToCMSPage:null,ConvertToKitPage:null,CreateAbTest:null,CreateComponent:null,CreateLayoutTemplate:null,CreateManagedCollection:null,CreateTeam:null,CustomBreakpoint:null,DashboardAddHeader:null,DashboardAddRedirect:null,DashboardAddRewrite:null,DashboardEditHeader:null,DashboardEditRedirect:null,DashboardEditRewrite:null,DashboardRequestProjectAccess:null,DeleteCodeFile:null,DeleteCustomFont:null,DeleteEntityFolder:null,DeleteFile:null,DeleteMultipleCodeFiles:null,DeleteMultipleEntityFolders:null,DeprecatedDrafts:null,DuplicateProjectWithVersion:null,DuplicateWebPage:null,EditCustomCode:null,FigmaImportTutorial:null,FlexToYearly:null,ImageCrop:El,ImageFocalPoint:Tl,ImportFigma:null,ImportRedirects:null,LoadingFullDocument:null,LocaleReady:null,LocaleSettings:null,LocalizationGlossary:null,None:null,NudgePreferences:null,OnPageCMSFieldsModal:Ac,OnPageRichTextEditor:_c,OnPageRichTextVariantOverride:Vc,OverrideFile:null,PasteFromFigma:null,PlanCancellation:null,PluginCustomHTML:null,PluginFromURL:null,PluginWithModePicker:null,PublishModule:null,QuickActions:null,RemoveTeamLibraryModule:null,ReplaceTextStylePreset:null,ReplaceWebPage:null,RequestControl:null,SelectProjectToUpgrade:null,Shortcuts:null,StopAbTest:null,SubscriptionNotInOrder:null,TransferProject:null,Templates:null,UnlinkComponent:null,UnsavedChanges:null,UnsupportedFileSize:null,UnsupportedFileType:null,UpgradeDocument:null,UpsellEnterprise:null,UpsellFeature:null,Variables:null,VectorImport:null,VectorSetCreation:null,ViewCustomCode:null,Welcome:null,KitRemix:null};function qc(){let o=x().stores.modalStore.useState(e=>e.stack);return o.map((e,t)=>{if(e.type==="None")return null;let n=hm[e.type];p(n,`Modal is missing: ${e.type}`);let{type:i,...a}=e,s=t===o.length-1,l=e.type+t;return(0,Fo.jsx)(Ma,{allowFocusTrap:s,children:(0,Fo.jsx)(_a.Provider,{value:Hs(i),children:(0,Fo.jsx)(ja.Provider,{value:s?"visible":"hidden",children:(0,Fo.jsx)(n,{...a})})})},l)})}function Gc({accessStore:r,routeStore:o},e){let t=r.access;p(t.status==="success","Can't open Framer if project access is not successful");let n=e??o.projectLinkNodeId,i=`${Bo().app}/projects/${t.data.projectSlug}?node=${n}`;window.open(`https://www.framer.com/open-in-app?url=${encodeURIComponent(i)}`,"_blank")}var Qc=y(oe());var Yc="t49i6vy",Dt="bjwo6qr",no="b1qwl3y9",$c="m1wta5up",Xc="m69kutt",On="sdjdrec",Zc="l9efojb";var Mn={slug:!0,string:!0,richtext:!0,link:!0,image:!0,array:!0,multicollectionreference:!0,collectionreference:!0,file:!0,date:!0,number:!0,boolean:!0,enum:!0,color:!0};function Fr(r){return Zs(r).flatMap(t=>{let n=t.type;return Mn[n]!==void 0?t.id:[]})}var T=y(U());function ed(){let r=x(),{routeStore:o,treeStore:e,canvasStore:t,projectStore:n,modalStore:i}=r.stores,a=v(()=>r.stores.canvasStore.finishedEditing,[]),{hasPermanentlyFailed:s}=n.useState(),l=a?.isNewItem?"Page saved":"Site saved",c=kc(),m=Oc(),d=(0,Qc.useCallback)(()=>{p(m,"Collection node must exist"),p(c,"Collection item node must exist");let f=Fr(m);r.exitTool(),i.set({type:"OnPageCMSFieldsModal",fieldIdsToShow:f,requiredFieldsOnly:!1,source:"on_page_hud",collectionItemId:c.id,collectionNodeId:m.id})},[o,e,i,r,c,m]),u=()=>{i.set({type:"Confirmation",title:"Discard Changes",description:"All changes will be lost. This action cannot be undone.",confirmLabel:"Discard",cancelLabel:"Cancel",variant:"destructive",source:"on_page_hud",onConfirm:()=>{t.discardTemporaryCollectionItem()}})},g=!!c?.privateToUserId;return(0,T.jsx)(T.Fragment,{children:(0,T.jsxs)("div",{className:Yc,children:[g?(0,T.jsxs)(G,{className:X(Dt,no),onClick:u,children:[(0,T.jsx)(Aa,{}),"Discard Page"]}):(0,T.jsx)(Um,{finishedEditing:a}),(0,T.jsxs)("div",{className:$c,children:[(0,T.jsx)(Jc,{desktopText:"Click to edit",mobileText:"Tap to edit",secondaryText:"Changes are auto-saved",isVisible:!a}),(0,T.jsx)(Jc,{desktopText:l,mobileText:l,secondaryText:`A notification was sent to your collaborators. ${a?.isNewItem?"The page":"Changes"} will be visible when the project is published.`,isVisible:!!a})]}),(0,T.jsxs)(Ee,{direction:"row",gap:10,children:[m&&!g&&!m.managedByPlugin&&!a&&(0,T.jsxs)(G,{className:X(Dt,no),enabled:!s,onClick:()=>t.createTemporaryCollectionItem(),"aria-label":"Add Page",children:[(0,T.jsx)(Ra,{}),(0,T.jsx)(vr,{desktopText:"Add Page",mobileText:"Page"})]}),g&&!s&&(0,T.jsxs)(G,{className:X(Dt,no),onClick:d,children:[(0,T.jsx)(Cm,{}),"Show All Fields"]}),a?(0,T.jsxs)(G,{className:X(Dt,no),onClick:()=>t.handleDismissFinishEditing(),children:[(0,T.jsx)(wm,{}),"Go Back to Site"]}):(0,T.jsxs)(G,{variant:"primary",className:Dt,onClick:()=>t.handleFinishEditing(),children:[(0,T.jsx)(Na,{"aria-hidden":"true"}),(0,T.jsx)(vr,{desktopText:"Finish Editing",mobileText:"Done"})]})]})]})})}function Jc({desktopText:r,mobileText:o,secondaryText:e,isVisible:t}){return(0,T.jsx)(Ri,{children:t&&(0,T.jsxs)(Xe.div,{className:Xc,initial:{marginTop:10,opacity:0},animate:{marginTop:0,opacity:1},exit:{marginTop:-10,opacity:0},children:[(0,T.jsx)(vr,{desktopText:r,mobileText:o}),(0,T.jsx)("span",{className:On,children:"\xB7"}),(0,T.jsx)("span",{className:On,children:e})]})})}function vr({desktopText:r,mobileText:o}){let e=el(`(max-width: ${va.tabletSmall}px)`);return!o&&e?null:(0,T.jsx)("span",{children:e?o:r})}function Um({finishedEditing:r}){let o=x(),e=()=>{Gc(o.stores,r?.isNewItem?r.nodeId:void 0)};return(0,T.jsxs)(G,{className:X(Dt,no),onClick:e,"aria-label":"Open in Framer",children:[(0,T.jsx)(Da,{"aria-hidden":"true",className:Zc}),(0,T.jsx)(vr,{desktopText:"Open in Framer"})]})}function wm(){return(0,T.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"9",height:"9",fill:"none",children:[(0,T.jsx)("path",{d:"M 1.5 7.5 L 8 1",fill:"transparent",strokeWidth:"1.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"}),(0,T.jsx)("path",{d:"M 3 1 L 8 1 L 8 6",fill:"transparent",strokeWidth:"1.5",stroke:"currentColor",strokeLinecap:"round",strokeLinejoin:"round"})]})}function Cm(){return(0,T.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"11",height:"11",fill:"none",children:[(0,T.jsx)("path",{d:"M1 5.5s1.5-3 4.5-3 4.5 3 4.5 3-1.5 3-4.5 3-4.5-3-4.5-3Z",fill:"transparent",strokeWidth:"1.5",stroke:"#fff",strokeLinecap:"round",strokeLinejoin:"round"}),(0,T.jsx)("path",{d:"M5.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3Z",fill:"#fff"})]})}var We=class extends Z{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i}getNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,Kt)||this.engine.tree.getNodeWithTrait(this.nodeId,E)}getVariableInfo(){let e=this.getNode();if(!e)return;let t=an(e);if(!t)return;let n=e.cache.getRenderInstance(this.renderId);if(n)return V(this.engine.tree,this.engine.stores.treeStore.sandboxCollectionData,t,"collectionreference",n.collectionItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,controlProp:i}=t;i.value!==e&&n.setControlProp(t.variableDefinition.id,{...i,value:e})}static supportsNode(e,t,n){let i=an(t);if(!i)return!1;let a=t.cache.getRenderInstance(n);return a?!!V(e.tree,e.stores.treeStore.sandboxCollectionData,i,"collectionreference",a.collectionItemId):!1}};var xm=["string","richtext","image","responsiveimage"],He=class r extends Z{constructor(e,t,n){super(e);this.nodeId=t;this.renderId=n}getCodeComponentNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,Be)}getEditableControls(){let e=this.getCodeComponentNode();if(e)return r.getEditableControls(this.engine,e,this.renderId)}update(){let e=this.engine,t=this.getCodeComponentNode();(!t||!r.supportsNode(e,t,this.renderId))&&e.exitTool()}stop(){let{modalStore:e}=this.engine.stores;e.stack.some(({type:n})=>n==="OnPageRichTextEditor")&&e.dismissAll()}static getEditableControls(e,t,n){let i=e.stores.routeStore.localeId,s=pt(e.tree,i).id!==re&&ze("onPageLocalizationSupport"),l=t.cache.getRenderInstance(n);if(!l)return Ao();let c=F.reactComponentForIdentifier(t.codeComponentIdentifier);if(!c)return Ao();let m=t.getControlProps(c.properties);if(!m)return Ao();let d=[],u=Bl(e,t.codeComponentIdentifier);if(qi(t)&&u&&!s)if(Ki(t)){let g=V(e.tree,e.stores.treeStore.sandboxCollectionData,t.dynamicVectorSetIdentifier,"vectorsetitem",l.collectionItemId);g&&d.push({type:"collection",controlKey:"dynamicVectorSetIdentifier",variableInfo:g})}else Si(t.codeComponentIdentifier)&&d.push({type:"vectorSetItem",codeComponentIdentifier:t.codeComponentIdentifier});for(let g in m){let f=m[g];if(!f||s&&!xm.includes(f.type))continue;let w=c.properties[g];if(w){if(f.type==="enum"&&ge.isOn("onPageEnumVariableOnComponentInstanceEditTool")&&!Le(f.value)){p(w.type==="enum");let h=St(w);p(h,"Reduced control prop should not be null"),bt(h,f,w),d.push({type:"component",controlKey:g,controlDescription:w,controlProp:f,reducedControlProp:h})}if(f.type==="string"){if(O(f.value)){let h=V(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,f.type,l.collectionItemId);if(!h)continue;let P=h.controlProp,A=null;s&&sn(P)&&(A=lt(e,P)),d.push({type:"collection",controlKey:g,variableInfo:h,localizedValue:A})}else if(!Le(f.value)){p(w.type==="string");let h=St(w);p(h,"Reduced control prop should not be null"),bt(h,f,w);let P=null;s&&sn(f)&&(P=lt(e,f)),d.push({type:"component",controlKey:g,controlDescription:w,controlProp:f,reducedControlProp:h,localizedValue:P})}}if(f.type==="richtext"){if(O(f.value)){let h=V(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,f.type,l.collectionItemId);if(!h)continue;d.push({type:"collection",controlKey:g,variableInfo:h})}else if(!Le(f.value)){p(w.type==="richtext");let h=St(w);p(h,"Reduced control prop should not be null"),bt(h,f,w),d.push({type:"component",controlKey:g,controlDescription:w,controlProp:f,reducedControlProp:h})}}if(f.type==="image"){if(O(f.value)){let h=V(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,f.type,l.collectionItemId);if(!h)continue;d.push({type:"collection",controlKey:g,variableInfo:h})}else if(!Le(f.value)){p(w.type==="image"||w.type==="responsiveimage");let h=St(w);p(h,"Reduced control prop should not be null"),bt(h,f,w),d.push({type:"component",controlKey:g,controlDescription:w,controlProp:f,reducedControlProp:h})}}if(f.type==="date"){if(O(f.value)){let h=V(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,"date",l.collectionItemId);if(!h)continue;d.push({type:"collection",controlKey:g,variableInfo:h})}else if(!Le(f.value)){p(w.type==="date");let h=St(w);p(h,"Reduced control prop should not be null"),bt(h,f,w),d.push({type:"component",controlKey:g,controlDescription:w,controlProp:f,reducedControlProp:h})}}if(f.type==="vectorsetitem"){if(O(f.value)){let h=V(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,"vectorsetitem",l.collectionItemId);if(!h)continue;d.push({type:"collection",controlKey:g,variableInfo:h})}else if(!Le(f.value)){p(w.type==="vectorsetitem");let h=St(w);p(h,"Reduced control prop should not be null"),bt(h,f,w),d.push({type:"component",controlKey:g,controlDescription:w,controlProp:f,reducedControlProp:h})}}if(f.type==="link"&&O(f.value)){let h=V(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,"link",l.collectionItemId);if(!h)continue;d.push({type:"collection",controlKey:g,variableInfo:h})}if(f.type==="boolean"&&O(f.value)){let h=V(e.tree,e.stores.treeStore.sandboxCollectionData,f.value,"boolean",l.collectionItemId);if(!h)continue;d.push({type:"collection",controlKey:g,variableInfo:h})}}}return d}static supportsNode(e,t,n){return Be(t)?r.getEditableControls(e,t,n).length>0:!1}};var je=class r extends Z{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,E)}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=r.getVariableReference(e);if(n)return V(this.engine.tree,this.engine.stores.treeStore.sandboxCollectionData,n,"date",t.collectionItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,variableDefinition:i,controlProp:a}=t;a.value!==e&&(n.setControlProp(i.id,{...a,value:e}),this.engine.stores.projectStore.commitTreeAndSend())}update(){let e=this.engine,t=this.getRichTextNode();(!t||!r.supportsNode(e,t,this.renderId))&&e.exitTool()}static getVariableReference(e){let t=e.textContent;if(!ko(t))return;let n=t.startValue;if(O(n))return n}static supportsNode(e,t,n){if(!E(t))return!1;let i=r.getVariableReference(t);if(!i)return!1;let a=t.cache.getRenderInstance(n);return a?!!V(e.tree,e.stores.treeStore.sandboxCollectionData,i,"date",a.collectionItemId):!1}};var _e=class r extends Z{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,E)}static getVariableReference(e){let t=e.textContent;if(!ko(t))return;let n=t.startValue;if(O(n))return n}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=r.getVariableReference(e);if(n)return V(this.engine.tree,this.engine.stores.treeStore.sandboxCollectionData,n,"enum",t.collectionItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}changeValue(e){let t=this.getVariableInfo();if(!t)return;let{collectionItemNode:n,variableDefinition:i,controlProp:a}=t;a.value!==e&&(n.setControlProp(i.id,{...a,value:e}),this.engine.stores.projectStore.commitTreeAndSend())}static supportsNode(e,t,n){if(!E(t))return!1;let i=r.getVariableReference(t);if(!i)return!1;let a=t.cache.getRenderInstance(n);return a?!!V(e.tree,e.stores.treeStore.sandboxCollectionData,i,"enum",a.collectionItemId):!1}};var qe=class r extends Z{constructor(e,t,n){super(e);this.nodeId=t;this.renderId=n}update(){let e=this.engine,t=e.tree.get(this.nodeId);(!t||!r.supportsNode(e,t,this.renderId))&&e.exitTool()}static supportsNode(e,t,n){if(!Kt(t))return!1;if(O(t.fillImage)){let i=t.cache.getRenderInstance(n);return i?!!V(e.tree,e.stores.treeStore.sandboxCollectionData,t.fillImage,"image",i.collectionItemId):!1}return!Li(t.fillImage)}};var td,od,br,Vn,ue=class extends(od=Z,td=[D()],od){constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.onCancelWithoutMove=i;N(this,Vn,C(br,8,this,!1)),C(br,11,this);I(this,"beginState",null);I(this,"beginStates",new Map);I(this,"previousInsertionIndex");I(this,"handleKeyDown",()=>{});I(this,"state");let{mouseStore:a}=this.engine.stores,s=e.tree.get(this.nodeId);B(s,"Node must exist"),this.beginState=os(e.tree,s,a.canvasMousePosition),this.beginStates.set(s,this.beginState),this.listenForEscapeKey()}listenForEscapeKey(){this.handleKeyDown=e=>{if(e.key==="Escape"){let t=Uo(this.beginState?.parent)?this.beginState.parent.getChildrenInVisualOrder().findIndex(n=>n.id===this.nodeId):-1;this.previousInsertionIndex=t,e.preventDefault(),e.stopPropagation(),this.endMoveTool()}},window.addEventListener("keydown",this.handleKeyDown)}endMoveTool(){this.hasMoved?this.commitMove():this.onCancelWithoutMove()}update(){let{treeStore:e,mouseStore:t,canvasStore:n,routeStore:i}=this.engine.stores,a=e.tree.get(this.nodeId);if(!a)return this.endMoveTool();let s=pe({screenWidth:n.screenWidth,tree:e.tree,webPageNodeId:i.webPageNodeId});if(!t.isMouseDown||!s){this.endMoveTool();return}let c=e.tree,m=t.canvasMousePosition;B(this.beginState,"beginState must be defined"),B(Uo(this.beginState.parent),"parent must be a stack or grid component");let d=ae.subtract(m,this.beginState.canvasPointUnderMouse);if(this.hasMoved=d.x!==0||d.y!==0,!this.hasMoved)return;let u=this.getPlaceholder(a,this.beginState.parent);if(!u)return;let g=this.beginState.rect,f=ae.add(g,d),h=a.cache.getRenderInstance(this.renderId)?.parentRenderId??this.beginState.parent.id,P=c.convertPointToCanvas(this.beginState.parent,f,void 0,void 0,h);this.state={renderId:this.renderId,nodeId:this.nodeId,rect:{height:u.size.height,left:P.x,top:P.y,width:u.size.width},placeholder:u}}stop(){window.removeEventListener("keydown",this.handleKeyDown)}commitMove(){let{treeStore:e}=this.engine.stores,t=e.tree.get(this.nodeId);if(!t){this.state=void 0,this.engine.exitTool();return}let n=Uo(this.beginState?.parent)?this.beginState.parent.getChildrenInVisualOrder().findIndex(i=>i.id===t.id):-1;this.beginState?.parent&&Io(this.previousInsertionIndex)&&this.previousInsertionIndex!==n&&this.engine.tree.moveNode(t,this.beginState.parent.id,this.previousInsertionIndex),this.state=void 0,this.engine.stores.projectStore.commitTreeAndSend(),setTimeout(()=>{this.engine.exitTool()},50)}getPlaceholder(e,t){if(!e)return null;let n=this.engine.tree.getRect(e,void 0,void 0,void 0,this.renderId),a=e.cache.getRenderInstance(this.renderId)?.parentRenderId??t.id,s={width:n.width,height:n.height},l=ts(this.engine.tree,this.engine.stores.treeStore.layoutCache,this.engine.stores.mouseStore.canvasMousePosition,this.engine.stores.mouseStore.previous.canvasMousePosition,this.beginStates,t,this.engine.tree.convertPointToNode(t,this.engine.stores.mouseStore.canvasMousePosition,void 0,a),this.previousInsertionIndex);return s&&Io(l)&&t?(this.previousInsertionIndex!==l&&(this.previousInsertionIndex=l),{renderId:a,nodeId:t.id,size:s,index:l}):null}static supportsNode(e,t){if(Wi(t))return!1;let n=t.parentid?e.tree.get(t.parentid):null;if(!n?.children)return!1;let i=n&&n.children.length>1;return ge.isOn("onPageMoveTool")&&Uo(n)&&!sa(t)&&i&&!aa(t)&&!e.stores.canvasStore.temporaryCollectionItemNodeId}};br=ne(od),Vn=new WeakMap,S(br,4,"hasMoved",td,ue,Vn),ie(br,ue);var Oe=class r extends Z{constructor(e,t,n,i){super(e);this.nodeId=t;this.renderId=n;this.eventSource=i;this.engine.beginUndoGroup();let a=this.getRichTextNode();p(a,"Missing rich text node");let s=ar(this.engine.tree,a);ft.loadFonts(s).catch(le)}getRichTextNode(){return this.engine.tree.getNodeWithTrait(this.nodeId,E)}getVariableReference(){let e=this.getRichTextNode();if(!e)return;let t=e.textContent;if(O(t))return t}getVariableInfo(){let e=this.getRichTextNode();if(!e)return;let t=e.cache.getRenderInstance(this.renderId);if(!t)return;let n=this.getVariableReference();if(n)return V(this.engine.tree,this.engine.stores.treeStore.sandboxCollectionData,n,"string",t.collectionItemId)}getControlProp(){return this.getVariableInfo()?.controlProp}getValue(){let e=this.getVariableInfo();if(!e)return;let{controlProp:t}=e;return p(t,"Control prop must exist"),oo(this.engine,t,"text")}changeValue(e){let t=this.getVariableInfo(),n=this.getRichTextNode();if(p(n,"Rich text node must exist"),!t)return;let{collectionItemNode:i,variableDefinition:a,controlProp:s}=t;if(p(s,"Control prop must exist"),this.engine.tree.root.getLocale(this.engine.stores.routeStore.localeId).id!==qt)xr(this.engine,t,e,n);else{if(s.value===e)return;i.setControlProp(a.id,{...s,value:e})}this.engine.stores.projectStore.commitTreeAndSend()}update(){let e=this.engine,t=this.getRichTextNode();if(!t||!r.supportsNode(e,t,this.renderId))e.exitTool();else{let n=this.getVariableInfo();this.engine.stores.toolStore.validateCollectionControl(n)}}stop(){this.engine.endUndoGroup(),this.engine.stores.toolStore.nodeInTextEditorId=null}static supportsNode(e,t,n){if(!E(t)||!O(t.textContent))return!1;let i=t.cache.getRenderInstance(n);return i?!!V(e.tree,e.stores.treeStore.sandboxCollectionData,t.textContent,"string",i.collectionItemId):!1}};var Me=class r extends Z{update(){let o=this.engine,{routeStore:e,canvasStore:t,treeStore:n,mouseStore:i,toolStore:a}=o.stores,s=pe({screenWidth:t.screenWidth,tree:n.tree,webPageNodeId:e.webPageNodeId});if(!s||i.isHoveringFloatingCanvasChrome)return;if(i.isHoveringChrome){a.highlightedRenderId=void 0;return}let l=n.tree,c=i.canvasMousePosition,m=l.getNodeRendersAtPoint(s,c,!0),d=wa(m,l),g=d.filter(h=>r.isLockedOrBlockedByAnOverlappedLockedLayer(o,h.node,h.renderId)||r.isInteractiveNodeOrTopLevelRepeaterNode(o,h.node,h.renderId)).at(-1);if(g){o.stores.toolStore.highlightedRenderId=g.renderId;return}let w=d.filter(h=>r.isUnexpectedlyNonInteractiveNode(o,h.node,h.renderId)).at(-1);if(w){a.highlightedRenderId=w.renderId;return}a.highlightedRenderId=void 0}static isInteractiveNodeOrTopLevelRepeaterNode(o,e,t){return r.isInteractiveNode(o,e,t)||Sr(o,e)}static isHighlightableNode(o,e,t){return r.isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t)?!1:He.supportsNode(o,e,t)||je.supportsNode(o,e,t)||qe.supportsNode(o,e,t)||he.supportsNode(o,e)||we.supportsNode(o,e,t)||Oe.supportsNode(o,e,t)||We.supportsNode(o,e,t)||_e.supportsNode(o,e,t)}static isNodeSupported(o,e,t){return He.supportsNode(o,e,t)||je.supportsNode(o,e,t)||qe.supportsNode(o,e,t)||he.supportsNode(o,e)||we.supportsNode(o,e,t)||Oe.supportsNode(o,e,t)||We.supportsNode(o,e,t)||_e.supportsNode(o,e,t)||ue.supportsNode(o,e)}static isInteractiveNode(o,e,t){return r.isNodeSupported(o,e,t)&&!r.isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t)}static isUnexpectedlyNonInteractiveNode(o,e,t){return r.isNodeSupported(o,e,t)?r.isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t):la(e)||Be(e)}static isLockedOrBlockedByAnOverlappedLockedLayer(o,e,t){if(ge.isOff("onPageLockedLayers"))return!1;if(fn(e)&&r.isNodeSupported(o,e,t))return!0;let n=pe({screenWidth:o.stores.canvasStore.screenWidth,tree:o.stores.treeStore.tree,webPageNodeId:o.stores.routeStore.webPageNodeId});if(!n)return!1;let i=o.tree.getCornerPointsOnCanvasWithZoom(e,1),a=ae.centroid(i);return[...i,a].every(c=>{let m=o.tree.getNodesAtPoint(n,c),d=Yo(m,o.tree).reverse();for(let u of d){if(fn(u)&&r.isNodeSupported(o,u,t))return!0;if(u.id===t)return!1}})}};function Sr(r,o){return!(!ji(o)||qs(r.tree,o)||Oo(r.tree.getWebPageNodeFor(o)))}var ad=y(oe());var rd="ci35ri5",nd="suurpvn",id="s1xlu29h";var Er=y(U()),sd=(0,ad.memo)(function(){let o=x(),e=v(()=>o.stores.editableNodeHighlightStore.editableNodesHighlight,[]);return e?(0,Er.jsx)(Xe.div,{className:X(rd,nd),initial:{"--radius":`${e.minRadius}px`},animate:{"--radius":`${e.maxRadius}px`},transition:{duration:e.animationDuration/1e3,ease:"easeOut"},style:{top:e.minY,height:e.maxY-e.minY,"--x":`${e.originX}px`,"--y":`${e.originY}px`,"--gradient-size":`${e.gradientSize}px`},children:(0,Er.jsx)("div",{style:{position:"absolute",top:-e.minY},children:e.highlights.map(t=>(0,Er.jsx)("div",{className:id,style:{width:t.width,height:t.height,transform:t.transform,transformOrigin:"top left"}},t.renderId))})},e.animationId):null});var ld="h1czcor4";var fd=y(oe());var cd=y(oe()),dd=y(U()),ee=(0,cd.forwardRef)(function({tree:o,node:e,renderId:t,style:n,overrideRect:i,...a},s){let l=x(),c=v(()=>{if(i)return i;let d=l.stores.treeStore.domLayoutUpdate,u=o.getRect(e,void 0,void 0,void 0,t);return{width:u.width,height:u.height,x:0,y:0}},[o,e,t,i],De.equals),m=o.transformMatrixToNode(e,void 0,void 0,t);return(0,dd.jsx)("div",{...a,ref:s,style:{position:"absolute",width:c.width,height:c.height,top:c.y,left:c.x,transformOrigin:"top left",transform:m.toString(),...n}})});var Ln=y(U());function md({tool:r}){let{renderId:o}=r,e=Ie(),t=x(),n=t.tree,i=(0,fd.useRef)(null),a=r.getNode();if(Qt(i,()=>{t.exitTool()}),!!a&&e)return(0,Ln.jsx)(ee,{ref:i,tree:n,node:a,renderId:o,children:(0,Ln.jsx)(Ul,{tool:r,node:a,renderId:o,scopeNode:e})})}var pd="v1r7rm12";var Nr=y(U());function vm(r){return r.message}function Tr({validationWarning:r}){if(!r)return null;let o=vm(r);return(0,Nr.jsxs)("div",{className:pd,children:[(0,Nr.jsx)(ka,{width:10,height:10}),o]})}var vo=y(U());function ud({tool:r}){let{nodeId:o,renderId:e}=r,t=x(),n=v(()=>t.stores.toolStore.validationWarning,[]),i=v(()=>t.stores.treeStore.tree,[]),a=v(()=>t.stores.toolStore.editorOverlayClipPath,[]),s=Ie(),l=v(()=>t.stores.toolStore.proseMirror,[]),c=i.getNodeWithTrait(o,E);if(!c||!s||!l)return;function m(d){d.target===d.currentTarget&&t.exitTool()}return(0,vo.jsxs)(ee,{tree:i,node:c,renderId:e,children:[(0,vo.jsx)(Tr,{validationWarning:n}),(0,vo.jsx)(Pl,{tool:r,scopeNode:s,node:c,renderId:e,proseMirror:l,zoom:1,onClickOutside:m,hasValidationWarning:!!n,style:{clipPath:a}})]})}var io=y(oe());var gd="p6dts5z",yd="pcmqzkm";var Ar="nbqylm8",hd="v1pcr3uc",zn="p1mivvux",Id="t42x8tu",Ud="g1atul0u",wd="n1i0g06w",Cd="b1t4nog5",xd="r1wgs7ug",Pd="rsrrcv7",Fd="rckttk2",vd="r12nxotj",bd="r460cpk",Sd="rrb252f",Ed="rxpkzma",Td="c1ct4jl9";var _=y(U()),Sm=["bottom","top","right","left"],Em={x:ye.inputSpacing,y:ye.inputSpacing};function Tm(r){return r.controlProp.type==="string"}function Ad({tool:r}){let[o,e]=(0,io.useState)(null),t=x(),n=t.stores.modalStore.useState(g=>g.active.type!=="None"),[i,a]=(0,io.useState)(!1);!i&&n&&a(!0);let s=v(()=>t.stores.treeStore.tree,[]),l=s.getNodeWithTrait(r.nodeId,Yi),c=(0,io.useMemo)(()=>{let g=s;return r.getEditableControls()},[r,s]);function m(){t.exitTool()}let d=l?.id,u=(0,io.useMemo)(()=>d?[d]:[],[d]);if(!(!l||!c||c.length===0))return(0,_.jsx)(ee,{tree:s,node:l,ref:e,renderId:r.renderId,className:Ar,children:(0,_.jsx)($o,{anchor:o,alignSelf:"center",attachTo:Sm,offset:Em,onClose:m,showArrow:!0,arrow:{anchor:o,alignSelf:"center"},fallbackToModalAppearance:!0,backdropTintEnabled:!1,className:X(gd,n&&yd),focusTrapEnabled:!n,animateAppear:!i,zIndex:21,children:(0,_.jsx)(wl,{displayDivider:!0,title:Dm(l),onClose:m,children:(0,_.jsx)(Ee,{gap:0,paddingTop:ye.inputSpacing,paddingBottom:ye.inputSpacing,paddingLeft:ye.panelPadding,paddingRight:ye.panelPadding,children:c.map(g=>{switch(g.type){case"vectorSetItem":return(0,_.jsx)(Dl,{nodeIds:u,supportsVariables:!1,dynamicVectorSetIdentifier:void 0,codeComponentIdentifier:g.codeComponentIdentifier});case"component":return(0,_.jsx)(Am,{editableControl:g,node:l,nodeIds:u});case"collection":return(0,_.jsx)(Nm,{editableControl:g,nodeIds:u,node:l});default:Wt(g)}})})})})})}function Nm({editableControl:r,nodeIds:o,node:e}){let{variableInfo:t,localizedValue:n}=r,i=x(),{controlProp:a,controlDescription:s,collectionItemNode:l,variableDefinition:c,reducedControlProp:m}=t;switch(a.type){case"string":{p(s.type==="string"),p(m.type==="string");let d;return n&&(d={...m,value:n.value}),(0,_.jsx)(Po,{nodeIds:o,controlKey:c.id,control:s,controlProp:d??m,onChange:(u,g)=>{p(a.type==="string");let f=i.tree.root.getLocale(i.stores.routeStore.localeId),w=g(a);if(f.id!==re){if(!z(w.value)||!Tm(t)){i.exitTool();return}xr(i,t,w.value,e)}else{if(me(w,a))return;l.setControlProp(u,w),i.stores.projectStore.commitTreeAndSend()}}},r.controlKey)}case"enum":return p(s.type==="enum"),p(m.type==="enum"),(0,_.jsx)(xo,{controlKey:c.id,control:s,controlProp:m,onChange:(d,u)=>{p(d.type==="enum"),!me(d,a)&&(l.setControlProp(u,d),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"richtext":return p(s.type==="richtext"),p(m.type==="richtext"),(0,_.jsx)(gn,{title:s.title||Vi(c.id),children:(0,_.jsx)(G,{title:"Edit Content",className:un,onClick:()=>{i.stores.modalStore.set({type:"OnPageRichTextEditor",controlKey:c.id,nodeId:l.id,source:"on_page_hud"})}})},r.controlKey);case"image":return p(s.type==="responsiveimage"),p(m.type==="responsiveimage"),(0,_.jsx)(In,{nodeIds:o,controlKey:c.id,control:s,controlProp:m,onChange:(d,u)=>{p(a.type==="image");let g=u(a);me(g,a)||(l.setControlProp(d,g),i.stores.projectStore.commitTreeAndSend())},onUpload:async(d,u)=>{let g=await d;g&&(l.setControlProp(u,{type:"image",value:g}),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"date":return p(s.type==="date"),p(m.type==="date"),(0,_.jsx)(yn,{controlKey:c.id,control:s,controlProp:m,onChange:(d,u)=>{p(d.type==="date"),p(a.type==="date"),!me(d,a)&&(l.setControlProp(u,d),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"link":return p(s.type==="link"),p(m.type==="link"),(0,_.jsx)(Zl,{controlKey:c.id,control:s,controlProp:m,onChange:(d,u)=>{p(a.type==="link");let g=u(a);me(g,a)||(l.setControlProp(d,g),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"boolean":return p(s.type==="boolean"),p(m.type==="boolean"),(0,_.jsx)(yr,{nodeIds:o,controlKey:c.id,control:s,controlProp:m,onChange:(d,u)=>{p(d.type==="boolean"),p(a.type==="boolean"),!me(d,a)&&(l.setControlProp(u,d),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"vectorsetitem":return p(s.type==="vectorsetitem"),p(m.type==="vectorsetitem"),(0,_.jsx)(Un,{controlKey:c.id,control:s,controlProp:m,onChange:(d,u)=>{p(d.type==="vectorsetitem"),p(a.type==="vectorsetitem"),!me(d,a)&&(l.setControlProp(u,d),i.stores.projectStore.commitTreeAndSend())}},r.controlKey);default:Wt(a)}}function Am({editableControl:r,nodeIds:o,node:e}){let t=x();switch(r.controlDescription.type){case"string":{p(r.reducedControlProp.type==="string");let n=r.localizedValue,i;return n&&(i={...r.reducedControlProp,value:n.value}),(0,_.jsx)(Po,{nodeIds:o,controlKey:r.controlKey,control:r.controlDescription,controlProp:i??r.reducedControlProp,onChange:(a,s)=>{p(r.controlProp.type==="string");let l=s(r.controlProp),c=t.tree.root.getLocale(t.stores.routeStore.localeId);if(c.id!==re){if(!z(l.value)||!z(r.controlProp.value)){t.exitTool();return}ro(t,e,r.controlProp.value,l.value,c,m=>tr(m,a,void 0))}else{if(me(l,r.controlProp))return;e.setControlProp(a,l),t.stores.projectStore.commitTreeAndSend()}}},r.controlKey)}case"enum":return p(r.reducedControlProp.type==="enum"),(0,_.jsx)(xo,{controlKey:r.controlKey,control:r.controlDescription,controlProp:r.reducedControlProp,onChange:(n,i)=>{p(r.controlProp.type==="enum"),!me(n,r.controlProp)&&(e.setControlProp(i,n),t.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"richtext":return p(r.reducedControlProp.type==="richtext"),(0,_.jsx)(gn,{title:r.controlDescription.title??"Unknown",children:(0,_.jsx)(G,{title:"Edit Content",className:un,onClick:()=>{t.stores.modalStore.set({type:"OnPageRichTextEditor",controlKey:r.controlKey,nodeId:e.id,source:"on_page_hud"})}})},r.controlKey);case"image":case"responsiveimage":return p(r.reducedControlProp.type==="image"||r.reducedControlProp.type==="responsiveimage"),(0,_.jsx)(In,{nodeIds:o,controlKey:r.controlKey,control:r.controlDescription,controlProp:r.reducedControlProp,onChange:(n,i)=>{p(r.controlProp.type==="image");let a=i(r.controlProp);me(a,r.controlProp)||(e.setControlProp(n,a),t.stores.projectStore.commitTreeAndSend())},onUpload:async(n,i)=>{let a=await n;if(!a)return;p(r.controlProp.type==="image");let s=Nl(r.controlProp,a);e.setControlProp(i,s),t.stores.projectStore.commitTreeAndSend()}},r.controlKey);case"date":return p(r.reducedControlProp.type==="date"),(0,_.jsx)(yn,{controlKey:r.controlKey,control:r.controlDescription,controlProp:r.reducedControlProp,onChange:(n,i)=>{p(n.type==="date"),!me(n,r.controlProp)&&(e.setControlProp(i,n),t.stores.projectStore.commitTreeAndSend())}},r.controlKey);case"vectorsetitem":return p(r.reducedControlProp.type==="vectorsetitem"),(0,_.jsx)(Un,{controlKey:r.controlKey,control:r.controlDescription,controlProp:r.reducedControlProp,onChange:(n,i)=>{p(n.type==="vectorsetitem"),!me(n,r.controlProp)&&(e.setControlProp(i,n),t.stores.projectStore.commitTreeAndSend())}},r.controlKey);default:Wt(r.controlDescription)}}function Dm(r){let o=F.reactComponentForIdentifier(r.codeComponentIdentifier);return o?o.name:"Component"}var Dr=y(oe());var Wn=y(U());function Dd({tool:r}){let{nodeId:o,renderId:e}=r,t=x(),n=t.tree,i=(0,Dr.useRef)(null),a=Ie(),s=n.getNodeWithTrait(o,E);if(Qt(i,()=>{t.exitTool()}),(0,Dr.useEffect)(()=>(document.body.style.overflow="hidden",()=>{document.body.style.overflow="auto"})),!!s&&a)return(0,Wn.jsx)(ee,{ref:i,tree:n,node:s,renderId:e,children:(0,Wn.jsx)(Cl,{tool:r,scopeNode:a,node:s,renderId:e,backdropEnabled:!0})})}var Bd=y(oe());var Hn=y(U());function Rd({tool:r}){let{nodeId:o,renderId:e}=r,t=x(),n=t.tree,i=(0,Bd.useRef)(null),a=Ie(),s=n.getNodeWithTrait(o,E);if(Qt(i,()=>{t.exitTool()}),!!s&&a)return(0,Hn.jsx)(ee,{ref:i,tree:n,node:s,renderId:e,children:(0,Hn.jsx)(xl,{tool:r,node:s,renderId:e,scopeNode:a})})}var Bt=y(oe());var de=y(U());function Od(){let r=x(),o=v(()=>r.stores.treeStore.tree,[]),e=v(()=>r.stores.toolStore.highlightedRenderId,[]),t=v(()=>r.stores.mouseStore.lastUpdateType==="scroll",[]),n=v(()=>r.stores.mouseStore.isHoveringFloatingCanvasChrome,[]),i=jt("onPageQuickAddRepeaterItems"),a=vt(e),s=o.get(a),l=en(s),c=!Se(e),m=(0,Bt.useMemo)(()=>{if(!i||!s||!e)return null;if(Sr(r,s))return s;let A=s.ancestors();for(let b of A)if(Sr(r,b))return b;return null},[s,e,i]),d=l&&c,u=d&&!t&&Me.isHighlightableNode(r,s,e),g=d&&Me.isUnexpectedlyNonInteractiveNode(r,s,e),f=d&&!g&&!n&&Me.isInteractiveNode(r,s,e),w=!!m&&!t,h=Rm({highlightedNode:s,highlightedRenderId:e,engine:r}),P=Om(s,e);return(0,de.jsxs)(de.Fragment,{children:[(0,de.jsx)(Bm,{notAllowedCursor:g}),d&&(0,de.jsxs)(de.Fragment,{children:[f&&(0,de.jsx)(ee,{tree:o,node:s,renderId:e,className:X(Ar,!u&&hd,h),onMouseDown:P}),w&&(0,de.jsx)(Mm,{tree:o,highlightedRenderId:e,repeaterNode:m})]})]})}function Bm(r){let o=x(),e=(0,Bt.useCallback)(()=>{o.stores.editableNodeHighlightStore.highlight(o,{type:"clickOnVoid"})},[]);return(0,de.jsx)("div",{"aria-hidden":!0,className:X(Cd,r.notAllowedCursor&&wd),onClick:e})}function Rm({highlightedNode:r,highlightedRenderId:o,engine:e}){let t=en(r),n=!Se(o);return!t||!n?zn:he.supportsNode(e,r)||we.supportsNode(e,r,o)||Oe.supportsNode(e,r,o)?Id:ue.supportsNode(e,r)?Ud:zn}var km=r=>{switch(r){case"top":return Pd;case"bottom":return Fd;case"left":return vd;case"right":return bd}};function Om(r,o){let e=x();return(0,Bt.useCallback)(()=>{!r||!o||(ue.supportsNode(e,r)?e.startMoveTool(r.id,o,()=>{kd(e,r,o)||e.startHighlightTool()}):kd(e,r,o))},[r,o])}function kd(r,o,e){return He.supportsNode(r,o,e)?(r.startComponentInstanceEditTool(o.id,e),!0):je.supportsNode(r,o,e)?(r.startDateVariableEditTool(o.id,e,"mouse"),!0):qe.supportsNode(r,o,e)?(r.startImageEditTool(o.id,e),!0):he.supportsNode(r,o)?(r.startRichTextEditTool(o.id,e,"mouse"),!0):we.supportsNode(r,o,e)?(r.startRichTextVariableEditTool(o.id,e,"mouse"),!0):Oe.supportsNode(r,o,e)?(r.startStringVariableEditTool(o.id,e,"mouse"),!0):We.supportsNode(r,o,e)?(r.startCollectionReferenceVariableEditTool(o.id,e,"mouse"),!0):_e.supportsNode(r,o,e)?(r.startEnumVariableEditTool(o.id,e,"mouse"),!0):(r.stores.editableNodeHighlightStore.highlight(r,{type:"clickOnVoid"}),!1)}function Mm(r){let o=x(),{mouseStore:e}=o.stores,{tree:t,highlightedRenderId:n,repeaterNode:i}=r,a=v(()=>e.canvasMousePosition,[],tn),s=v(()=>o.stores.treeStore.domLayoutUpdate,[],tn),l=(0,Bt.useMemo)(()=>{if(!i)return;let m=ca(t,i);if(!m)return;let d=m.cache.domRects,u=null;for(let[g,f]of d??[])u=u?De.merge(u,f):f;if(u)return u},[t,i,s]),c=(0,Bt.useMemo)(()=>{let m="bottom";if(!i)return m;let d=Hi(i)&&i.stackDirection==="horizontal"&&!i.stackWrapEnabled,u=t.convertFrameToCanvas(i,l,n);if(d){let b=u.x,q=b+u.width,K=window.scrollX,se=K+window.innerWidth,Ke=b>=K&&b<=se,Ve=q>=K&&q<=se;if(Ke&&!Ve)return"left";if(Ve&&!Ke)return"right";if(Ke&&Ve){let Ge=a.x-b,Q=q-a.x;return Ge<Q?"left":"right"}return"right"}let g=u.y,f=g+u.height,w=window.scrollY,h=w+window.innerHeight,P=g>=w&&g<=h,A=f>=w&&f<=h;if(P&&!A)return"top";if(A&&!P)return"bottom";if(P&&A){let b=a.y-g,q=f-a.y;return b<q?"top":"bottom"}return m},[i,n,l,a,t.convertFrameToCanvas]);return i?(0,de.jsx)(ee,{tree:t,node:i,renderId:n,className:Td,overrideRect:l,children:(0,de.jsxs)("button",{type:"button",className:X(Sd,km(c)),onMouseDown:()=>Vm(o,i.id),[Cn]:"true",children:[(0,de.jsx)(Oa,{className:Ed,children:(0,de.jsx)(Ta,{})}),(0,de.jsx)("div",{className:xd})]})}):null}function Vm(r,o){let{treeStore:e,projectStore:t,modalStore:n,accessStore:i}=r.stores,a=e.tree.getNodeWithTrait(o,rn),s=rn(a)&&Oo(a)?ra(e.tree,a.dataIdentifier):void 0,l=i.access?.userId;p(l,"User must be logged in"),p(s,"Collection node must exist");let c=Go.create({isDraft:!0,privateToUserId:l});mr(s,c),e.tree.insertNode(c,s.id,0),t.commitTreeAndSend(),n.set({type:"OnPageCMSFieldsModal",fieldIdsToShow:Fr(s),requiredFieldsOnly:!1,source:"on_page_hud",collectionNodeId:s.id,collectionItemId:c.id})}var Ce=y(oe());var Md="pqnmppj";var xe=y(U()),zm=["right","left"],Wm={x:15,y:0};function Vd({tool:r}){let{nodeId:o,renderId:e}=r,[t,n]=(0,Ce.useState)(null),i=x(),a=i.stores.routeStore.localeId,s=i.tree.root.getLocale(a),l=s.id!==re&&ze("onPageLocalizationSupport"),c=v(()=>i.stores.treeStore.tree,[]),m=c.getNodeWithTrait(o,Kt);function d(){i.exitTool()}if(!m)return;let u=l?At(i,m,ls):void 0;return(0,xe.jsx)(ee,{tree:c,node:m,renderId:e,ref:n,children:(0,xe.jsxs)($o,{anchor:t,alignSelf:"center",attachTo:zm,offset:Wm,onClose:d,showArrow:!0,arrow:{anchor:t,alignSelf:"center"},fallbackToModalAppearance:!0,backdropTintEnabled:!1,children:[(0,xe.jsx)(Ka,{disableDivider:!0,onClose:d,children:(0,xe.jsx)(Ga,{title:"Image"})}),(0,xe.jsx)("div",{className:Md,children:is(u)?(0,xe.jsx)(Hm,{activeLocale:s,source:u}):Le(m.fillImage)?(0,xe.jsx)(jm,{node:m,dynamicValue:m.fillImage,renderId:e}):(0,xe.jsx)(qm,{node:m,tree:c})})]})})}function Hm({activeLocale:r,source:o}){let e=x(),t=e.tree.root.locales,n=pt(e.tree,r.id);p(t,"Locales must exist");let{imageValue:i,imageFallback:a,handleImageUpload:s,updateAssetSize:l,imagePositionX:c,imagePositionY:m,handleFocalPointChange:d}=Kl(e,o,r,t,"on-page-image-edit-tool"),u=o.localizedValues[r.id],g=Gt(n,o.localizedValues),f=u?.value??"",w=g?.value??o.value??"";return(0,xe.jsx)(sl,{altText:f,altTextPlaceholder:w,onChangeAltText:P=>{P===""?Ds(e,o,r,{target:"default",trackingSource:"on-page-image-edit-tool"}):P!==f&&Et(e,P,o,r,{trackingSource:"on-page-image-edit-tool"})},imageReference:i??a??"",onChange:s,onChangeAssetSize:l,positionX:c,positionY:m,onChangeFocalPosition:d})}function jm({node:r,dynamicValue:o,renderId:e}){return p(O(o),"Expected variable reference"),(0,xe.jsx)(_m,{node:r,variableReference:o,renderId:e})}function _m({node:r,variableReference:o,renderId:e}){let t=x(),n=v(()=>{let m=t.stores.treeStore,d=r.cache.getRenderInstance(e);return V(m.tree,m.sandboxCollectionData,o,"image",d?.collectionItemId)},[r,e,o]);p(n,"Variable info must exist");let{collectionItemNode:i,reducedControlProp:a,controlProp:s}=n;p(a.type==="responsiveimage","Expected reduced responsive image");let l=(0,Ce.useCallback)(m=>{i.set(nn({[o.id]:m(s)})),t.stores.projectStore.commitTreeAndSend()},[i,o,s]),c=(0,Ce.useCallback)(()=>{i.set(nn({[o.id]:{type:"image",value:void 0}})),t.stores.projectStore.commitTreeAndSend()},[i,o]);return(0,xe.jsx)(ll,{controlProp:a,onChange:l,onRemove:c,maxExtraImages:0})}function qm({node:r,tree:o}){let e=x(),t=(0,Ce.useMemo)(()=>{let d={...js(),...Ks()};return _s(o,r,d),Gs(r,d),d},[r,o]),n=(0,Ce.useCallback)(async d=>{let[u]=await d;u&&(As(r,u),e.stores.projectStore.commitTreeAndSend())},[r]),i=(0,Ce.useCallback)(d=>{z(r.fillImage)&&(r.set({fillImage:Bi(r.fillImage,d)}),e.stores.projectStore.commitTreeAndSend())},[r]),a=(0,Ce.useCallback)(d=>{da(r)&&(r.set({altAttribute:d}),e.stores.projectStore.commitTreeAndSend())},[r]),s=(0,Ce.useCallback)(d=>{r.set({fillImageResize:d}),e.stores.projectStore.commitTreeAndSend()},[r]),l=(0,Ce.useCallback)(d=>{r.set({fillImageTileSize:d}),e.stores.projectStore.commitTreeAndSend()},[r]),c=(0,Ce.useCallback)((d,u)=>{r.set({fillImagePositionX:d,fillImagePositionY:u}),e.stores.projectStore.commitTreeAndSend()},[r]),m=(0,Ce.useCallback)(()=>{r.set({fillImage:void 0}),e.stores.projectStore.commitTreeAndSend()},[r]);return(0,xe.jsx)(nl,{...t,imageReferences:t.fillImages,altText:t.altAttribute,onChangeImages:n,onChangeAssetSize:i,onChangeAltText:a,onChangeImageResize:s,onChangeFillImageSize:l,onChangeImagePosition:c,onRemoveImage:m})}var Ld="g189l9ii",zd="m1va6tk8";var Hd=y(U());function Wd({tool:r}){let o=x(),e=v(()=>r.hasMoved,[r]),t=v(()=>o.stores.treeStore.tree,[]),n=t.get(r.nodeId);if(!n)return null;let i=t.get(n.parentid);if(!i)return null;let s=n.cache.getRenderInstance(r.renderId)?.parentRenderId??i.id;return(0,Hd.jsx)(ee,{tree:t,node:i,renderId:s,className:X(e&&zd,e&&Ld)})}var qd=y(oe());var jd="w1uyyr5z",_d="w1z0oe1i";var bo=y(U());function Kd({richTextNode:r,webPageNode:o}){let e=x(),t=v(()=>e.stores.treeStore.tree,[]);return(0,qd.useMemo)(()=>{let i=t.getNodeWithTrait(r.getPrimaryId(),E);return p(i,"originalNode must exist"),o.getTopLevelReplicaVariants().some(a=>{let s=Co(a.id,i.id),l=t.get(s);return E(l)&&Ko(t,l,"html")&&l.getTextContent()!==i.getTextContent()})},[t,r,o])?(0,bo.jsxs)(Ea,{className:jd,onClick:()=>{e.exitTool(),e.stores.modalStore.set({richTextNodeId:r.id,source:"on_page_hud",type:"OnPageRichTextVariantOverride"})},children:[(0,bo.jsx)(Ba,{viewBox:"0 0 12 12",className:_d}),(0,bo.jsx)(rt,{children:"Responsive Text"})]}):null}var Gd="w1v62ead";var ao=y(U());function Yd({tool:r}){let{nodeId:o,renderId:e}=r,t=x(),n=v(()=>t.stores.treeStore.tree,[]),i=v(()=>t.stores.toolStore.editorOverlayClipPath,[]),a=v(()=>t.stores.toolStore.proseMirrorView,[]),s=n.getNodeWithTrait(o,E),l=Ie();return!s||!l||!a?null:(0,ao.jsxs)(ee,{tree:n,node:s,renderId:e,children:[(0,ao.jsx)("div",{className:Gd,children:(0,ao.jsx)(Kd,{richTextNode:s,webPageNode:l})}),(0,ao.jsx)(Fl,{tool:r,scopeNode:l,node:s,renderId:e,editorView:a,zoom:1,handleOutsideClick:c=>{c.target===c.currentTarget&&t.exitTool()},style:{clipPath:i}})]})}var So=y(U());function $d({tool:r}){let{nodeId:o,renderId:e}=r,t=x(),n=v(()=>t.stores.treeStore.tree,[]),i=v(()=>t.stores.toolStore.validationWarning,[]),a=v(()=>t.stores.toolStore.editorOverlayClipPath,[]),s=n.getNodeWithTrait(o,E),l=Ie();return!l||!s?null:(0,So.jsxs)(ee,{tree:n,node:s,renderId:e,children:[(0,So.jsx)(Tr,{validationWarning:i}),(0,So.jsx)(vl,{tool:r,scopeNode:l,node:s,renderId:e,zoom:1,onClickOutside:c=>{c.target===c.currentTarget&&t.exitTool()},hasValidationWarning:!!i,style:{clipPath:a}})]})}var fe=y(U());function Xd(){let r=x(),{sandboxStore:o}=r.stores,{canvasHeight:e}=o.useState(),t=v(()=>r.stores.treeStore.tree.getPresetsListNode(),[]);return(0,fe.jsxs)("div",{className:ld,style:{height:e??"initial"},children:[(0,fe.jsx)(sd,{}),(0,fe.jsx)($m,{}),(0,fe.jsx)(zs,{presetsListNode:t})]})}function $m(){let r=x(),{projectStore:o,modalStore:e}=r.stores,t=v(()=>r.stores.toolStore.tool,[]),n=v(()=>r.stores.canvasStore.finishedEditing,[]),{hasPermanentlyFailed:i}=o.useState(),a=e.useState(s=>s.active.type!=="None");if(!i&&!n&&!a){if(t instanceof ue)return(0,fe.jsx)(Wd,{tool:t});if(t instanceof Me)return(0,fe.jsx)(Od,{});if(t instanceof qe)return(0,fe.jsx)(Vd,{tool:t});if(t instanceof he)return(0,fe.jsx)(Yd,{tool:t});if(t instanceof we)return(0,fe.jsx)(ud,{tool:t});if(t instanceof Oe)return(0,fe.jsx)($d,{tool:t});if(t instanceof je)return(0,fe.jsx)(Dd,{tool:t});if(t instanceof We)return(0,fe.jsx)(md,{tool:t});if(t instanceof _e)return(0,fe.jsx)(Rd,{tool:t});if(t instanceof He)return(0,fe.jsx)(Ad,{tool:t})}}var Qe=y(U());function Zd(){eo();let r=x(),o=v(()=>r.stores.canvasStore.isHidden,[]);return(0,Br.useEffect)(()=>{let e=({data:t})=>{if(mt(t)&&t.apiVersion===1){let{type:n,position:i}=t;n==="showCanvas"&&mt(i)&&Io(i.top)&&(window.scrollTo({behavior:"instant",top:i.top}),setTimeout(()=>{r.stores.canvasStore.isHidden=!1,r.startHighlightTool(),r.stores.editableNodeHighlightStore.highlight(r,{type:"start"})},0))}};return window.addEventListener("message",e),()=>{window.removeEventListener("message",e)}},[]),(0,Br.useEffect)(()=>{let{sandboxStore:e}=r.stores;o?e.hide():e.show()},[o]),Xm(o),Xl({channel:Ei,toast:gt}),(0,Qe.jsx)(La,{children:(0,Qe.jsxs)("div",{className:X(o&&nc),children:[(0,Qe.jsx)(Xd,{}),(0,Qe.jsxs)("div",{className:ic,[wn]:"true",children:[(0,Qe.jsx)(ed,{}),(0,Qe.jsx)(qc,{}),(0,Qe.jsx)(Za,{padding:80}),(0,Qe.jsx)(Yl,{ref:r.stores.projectStore.filePickerRef})]})]})})}function Xm(r){let o=x();(0,Br.useEffect)(()=>{if(r)return;let e=new rl;e.set("CommandOrControl+Z",o.undo.bind(o),"undo"),e.set("CommandOrControl+Shift+Z",o.redo.bind(o),"redo");function t(n){if(sr())return;let i=e.get(n);i&&(ke("keyboard_shortcut",{shortcut:ol(n)}),i.action(n),n.preventDefault(),n.stopPropagation())}return window.addEventListener("keydown",t),()=>{window.removeEventListener("keydown",t)}},[r])}var Jd=y(oe());function Qd(){(0,Jd.useEffect)(()=>{let r=o=>{if(!mt(o.data))return;let{apiVersion:e,type:t}=o.data;e===1&&t==="enterOnPageEditing"&&ke("editor_bar_interaction",{page:"editor-bar-project-page",id:"editor-bar-enter-on-page-editing"})};return window.addEventListener("message",r),()=>window.removeEventListener("message",r)},[])}var Yn=y(oe());var so="https://app.framerstatic.com/framer-logo-blue-UQOIW3P5.png";var kr="b9jl8lf",Or="eptse9g";var ef="bzafg2a",tf="cnhgigm",of="t1ookr3o",rf="tyol4w7",nf="s7fryoi",af="by9jupw",sf="b18g1n4a",lf="c1gc3a0q";var lo=y(U());function cf({width:r=10,height:o=10,className:e}){return(0,lo.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:r,height:o,fill:"none",className:e,"aria-hidden":"true",children:(0,lo.jsxs)("g",{transform:"translate(2 2)",children:[(0,lo.jsx)("path",{d:"M 0 0 L 6 6",fill:"transparent",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"}),(0,lo.jsx)("path",{d:"M 0 6 L 6 0",fill:"transparent",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round"})]})})}var Pe=y(U());function Qm({children:r,onClick:o,disabled:e,layoutId:t,duration:n}){return(0,Pe.jsx)(Xe.div,{layout:"position",layoutId:t,style:{width:"100%"},transition:{duration:n,type:"spring",bounce:.2,delay:0},children:(0,Pe.jsx)(G,{type:"button",className:af,onClick:o,enabled:!e,children:r})})}function co({logo:r,title:o,subtitle:e,buttons:t,showLearnMoreButton:n}){let i=()=>{window.open("https://www.framer.com/help/articles/on-page-editing","_blank")},a=()=>{window.parent.postMessage({apiVersion:1,type:"sandboxReadyState",data:{status:"ready"}},"*"),window.parent.postMessage({apiVersion:1,type:"exitFullscreen",position:{top:window.scrollY}},"*")};return(0,Pe.jsx)(Ee,{className:ef,onClick:a,children:(0,Pe.jsxs)(Ee,{className:tf,justifyContent:"center",alignItems:"center",onClick:s=>s.stopPropagation(),children:[(0,Pe.jsx)(Ee,{onClick:a,className:lf,children:(0,Pe.jsx)(cf,{})}),(0,Pe.jsxs)(Ee,{className:of,gap:15,alignItems:"center",justifyContent:"center",children:[r,(0,Pe.jsxs)(Ee,{gap:5,alignItems:"center",justifyContent:"center",children:[(0,Pe.jsx)(Xe.span,{layout:!0,className:rf,children:o}),(0,Pe.jsx)(Xe.p,{layout:!0,className:nf,children:e})]})]}),t||n?(0,Pe.jsxs)(Ee,{className:sf,gap:10,children:[n?(0,Pe.jsx)(Qm,{onClick:i,children:"Learn More"}):null,t||null]}):null]})})}var Mr=y(U());function df(){let r=x();Jt("editor_bar_impression",{page:"editor-bar-cookie-prompt"});async function o(){ke("editor_bar_interaction",{page:"editor-bar-cookie-prompt",id:"editor-bar-allow-cookies"});try{await document.requestStorageAccess()}finally{await r.stores.accessStore.refresh()}}return(0,Mr.jsx)(co,{logo:(0,Mr.jsx)("img",{decoding:"async",width:36,src:so,alt:"Framer Logo"}),title:"Edit Page",subtitle:"Continuing may require granting permissions in a browser dialog.",buttons:(0,Mr.jsx)(G,{className:X(kr,Or),onClick:o,variant:"primary",children:"Continue"}),showLearnMoreButton:!0})}var qn=y(U());function ff({children:r,onClick:o,disabled:e,layoutId:t,duration:n,className:i}){return(0,qn.jsx)(Xe.div,{layout:"position",layoutId:t,style:{width:"100%"},transition:{duration:n,type:"spring",bounce:.2,delay:0},children:(0,qn.jsx)(G,{type:"button",className:X(kr,i),onClick:o,enabled:!e,children:r})})}var mf="l4nhz4u";var fo=y(U());function pf(){let r=x(),{isLoginInProgress:o}=r.stores.loginStore.useState();Jt("editor_bar_impression",{page:"editor-bar-guest-page"});async function e(){ke("editor_bar_interaction",{page:"editor-bar-guest-page",id:"editor-bar-login"}),await r.stores.loginStore.login()}return(0,fo.jsx)(co,{logo:(0,fo.jsx)("img",{decoding:"async",width:36,height:36,src:so,alt:"Framer Logo"}),title:"Edit Page",subtitle:"Edit the page directly in the browser, without opening the app.",buttons:(0,fo.jsx)(ff,{onClick:e,disabled:o,className:Or,children:o?(0,fo.jsx)("div",{className:mf,children:(0,fo.jsx)(Gl,{})}):"Continue"}),showLearnMoreButton:!0})}var Kn=y(U()),tp="Page Edit",op="To edit, ask the site owner for access to the project",rp="To edit, ask the site owner for content editing permissions";function Gn({reason:r}){return Jt("editor_bar_impression",{page:"editor-bar-no-access-page"}),(0,Kn.jsx)(co,{logo:(0,Kn.jsx)("img",{decoding:"async",width:36,src:so,alt:"Framer Logo"}),title:tp,subtitle:r==="no-permission"?rp:op,showLearnMoreButton:!0})}var Eo=y(U());function uf(){let r=x(),{access:o}=r.stores.accessStore.useState();switch(o.status){case"no-auth":return(0,Eo.jsx)(pf,{});case"unknown":return(0,Eo.jsx)(df,{});case"no-access":return(0,Eo.jsx)(Gn,{reason:"no-access"});case"no-permission":return(0,Eo.jsx)(Gn,{reason:"no-permission"});case"success":case"error":return null;default:Wt(o)}}var Rt=y(U());function gf(){let r=x(),{shouldRenderOnPageCanvas:o}=r.stores.accessStore.useState(),e=it(()=>r.stores.routeStore.webPageNodeId,[],[r.stores.routeStore]);return(0,Yn.useEffect)(()=>{e&&r.stores.sandboxStore.waitForInitialLoad(e).then(()=>{window.parent.postMessage({apiVersion:1,type:"sandboxReadyState",data:{status:"ready"}},"*")}).catch(le)},[e]),(0,Yn.useEffect)(()=>{r.performanceTracker.reportEditorBarReady()}),Qd(),(0,Rt.jsxs)(Rt.Fragment,{children:[(0,Rt.jsx)(uf,{}),o&&(0,Rt.jsx)(Zd,{})]})}var yf=y(oe());var If=y(U());function hf(){let r=x(),o=(0,yf.useCallback)(()=>{r.stores.contextMenuStore.close()},[]);return(0,If.jsx)(bl,{environment:"onPage",menu:r.stores.contextMenuStore.menu,onClose:o})}var Vr=class{constructor(o){this.engine=o;I(this,"state",0);I(this,"changes",new Pa)}get inRendering(){return this.state===3}render(){if(this.state!==1)return;let o=this.changes,e=this.engine.stores;try{this.state=2,o.has(e.treeStore,e.routeStore)&&Zo(e.treeStore.tree,e.treeStore.layoutCache,e.treeStore.sandboxCollectionData,e.treeStore.sandboxVisibility,F.activeBundleHash,e.routeStore.localeId,void 0,e.routeStore.webPageNodeId),e.toolStore.tool?.update?.(),e.undoRedoManager.processScheduledEndUndoGroup({}),this.state=3,e.sandboxStore.update(),o.signalAllObservers(),dl()}finally{this.state=0}}signalChanges(o){if(this.changes.addChanges(o),this.state!==0)return;this.state=1;let e=this.render.bind(this);setTimeout(e,0),cl()}wrapHandler(o,e){let{projectStore:t}=this.engine.stores;return function(...n){let i=o.apply(this,n);return t.commitTreeAndSend(e!=="nonUserEvent"),i}}process(o,e){this.wrapHandler(o,e)()}processWhenReady(o,e){this.wrapHandler(o,e)()}async processWhenReadyAsync(o,e){return this.wrapHandler(o,e)()}runWhenIdle(o){requestIdleCallback(o)}runWithFullyLoadedTree(o,e){p(e.runInBackground,"Only background tasks are supported in the OnPageEngine for now.");let t=this.engine.tree.getService("loader"),n=()=>{o(),this.engine.stores.projectStore.commitTreeAndSend()};if(!t)return n(),yt;let i=t.prioritizeLoadingAllData({operationName:e.name,operationInBackground:!0,doNotTrack:e.doNotTrack}),a=t.afterAllDataLoaded(n);return()=>{i(),a()}}runBeforeNextFrame(o){requestAnimationFrame(o)}scheduleDocumentUpdateIgnoringUndo(o){throw new Error("Not implemented")}};var Lr=class extends Re{constructor(e,t,n){super();this.projectStore=e;this.hostnameStore=t;this.siteId=n;I(this,"_access")}get access(){return p(this._access,"Access not initialized"),this._access}get projectId(){return Uf(this.access)}get canEditContent(){let e=this.access;return e.status!=="success"?!1:e.data.permissions?.canEditContent==="on"}get shouldRenderOnPageCanvas(){return xn()&&this.canEditContent}async set(e){if(this._access=e,this.shouldRenderOnPageCanvas){let t=Uf(e);e.userId&&t&&(this.projectStore.loadProject(e.userId,t),this.hostnameStore.loadHostnames(t).catch(le))}pa.setUserId(e.userId??"null")}async refresh(){let e=await $l(this.siteId);await this.set(e)}},np=/^(?<name>.+--)?(?<id>[a-z0-9]{20})(?<hash>-[a-z0-9]+)?$/iu;function Uf(r){if(r.status==="success")return np.exec(r.data.projectSlug)?.groups?.id}var wf,Cf,kt,$n,Xn;Cf=[D()],wf=[D()];var Ot=class{constructor(o){this.scheduler=o;N(this,$n,C(kt,8,this,[])),C(kt,11,this);N(this,Xn,C(kt,12,this)),C(kt,15,this);I(this,"assetMap",new Ai)}get assets(){return this._assets}get assetService(){return this._assetService}setAssetService(o){this._assetService=o,Di(o,e=>{e.assets&&(this._assets=e.assets,this.assetMap.set(e.assets),ft.importCustomFonts(this.assetMap.items(),ge.isOn("customFontGrouping")))})}};kt=ne(null),$n=new WeakMap,Xn=new WeakMap,S(kt,4,"_assets",Cf,Ot,$n),S(kt,4,"_assetService",wf,Ot,Xn),ie(kt,Ot);async function xf(r){return Ja.post("/edit/notifications/page-edited",r)}var Pf,Ff,vf,bf,Ne,Zn,Jn,Qn,ei;bf=[D()],vf=[D()],Ff=[D()],Pf=[D()];var ct=class{constructor(o,e,t,n,i,a,s,l,c){this.scheduler=o;this.accessStore=e;this.routeStore=t;this.treeStore=n;this.projectStore=i;this.modalStore=a;this.undoRedoManager=s;this.exitTool=l;this.onChangeRoute=c;N(this,Zn,C(Ne,8,this,!0)),C(Ne,11,this);N(this,Jn,C(Ne,12,this,null)),C(Ne,15,this);N(this,Qn,C(Ne,16,this,window.innerWidth)),C(Ne,19,this);N(this,ei,C(Ne,20,this)),C(Ne,23,this);window.addEventListener("resize",()=>{this._screenWidth=window.innerWidth})}get screenWidth(){return this._screenWidth}get temporaryCollectionItemNodeId(){return this._temporaryCollectionItemNodeId}set temporaryCollectionItemNodeId(o){this._temporaryCollectionItemNodeId=o,this.onChangeRoute()}async sendNotification(o){let e=this.accessStore.projectId;p(e,"Project ID must exist");let t=st({tree:this.treeStore.tree,webPageNodeId:this.routeStore.webPageNodeId});p(t,"Web page node must exist");let n=Je(this.routeStore,this.treeStore,this),i;if(n){let a=to(this.routeStore,this.treeStore,this);p(a,"Collection item exists, so its parent collection must exist");let s=a.resolveValue("name");p(s,"Collection node must have a name"),i={notificationType:o,projectId:e,webPageNodeId:t.id,collectionItemNodeId:n.id,collectionItemTitle:ip(a,n),collectionTitle:s,pageType:"cms-detail"}}else i={notificationType:o,projectId:e,webPageNodeId:t.id,pageTitle:t.webMetadata?.title||ns(this.treeStore.tree,t),pageType:"static"};await xf(i)}createTemporaryCollectionItem(){let o=to(this.routeStore,this.treeStore,this);if(!o)return;let e=this.accessStore.access?.userId;p(e,"User must be logged in");let t=o.getPrivateItemForUser(e);if(t)this.temporaryCollectionItemNodeId=t.id;else{let n=Go.create({isDraft:!0,privateToUserId:e});this.treeStore.tree.insertNode(n,o.id,0),this.temporaryCollectionItemNodeId=n.id,mr(o,n),this.projectStore.commitTreeAndSend()}}discardTemporaryCollectionItem(){let o=Je(this.routeStore,this.treeStore,this);p(o,"Collection item node must exist"),p(o.id===this.temporaryCollectionItemNodeId,"Collection item must be temporary"),this.treeStore.tree.remove(o.id),this.projectStore.commitTreeAndSend(),this.clearTemporaryItem(),this.exitFullscreen()}saveTemporaryCollectionItem(){let o=Je(this.routeStore,this.treeStore,this);p(o,"Collection item node must exist"),p(o.id===this.temporaryCollectionItemNodeId,"Collection item must be temporary"),o?.set({privateToUserId:void 0}),this.projectStore.commitTreeAndSend(),this.finishEditingWithChanges(o.id,!0)}handleFinishEditing(){this.exitTool();let o=Je(this.routeStore,this.treeStore,this);if(!!!o?.privateToUserId){if(!this.treeStore.hasChanged()){this.handleDismissFinishEditing();return}let l=this.routeStore.projectLinkNodeId;if(!l)return;this.finishEditingWithChanges(l,!1);return}let t=to(this.routeStore,this.treeStore,this);if(p(t&&o,"Collection node and collection item node must exist"),!o.hasData()){this.discardTemporaryCollectionItem();return}let n=lr(t,o);Qs(t,o,n)&&this.projectStore.commitTreeAndSend();let s=Js(this.treeStore.tree,t,o,n).flatMap(l=>{let c=l.type;return Mn[c]!==void 0?l.id:[]});s.length>0?this.modalStore.set({type:"OnPageCMSFieldsModal",fieldIdsToShow:s,requiredFieldsOnly:!0,source:"on_page_hud",collectionItemId:o.id,collectionNodeId:t.id}):this.saveTemporaryCollectionItem()}finishEditingWithChanges(o,e){this.finishedEditing={isNewItem:e,nodeId:o},ke("editor_bar_interaction",{page:"editor-bar-project-page",id:"editor-bar-finish-editing-with-changes"});let t=e?"page-created":"page-edited";this.sendNotification(t).catch(le)}handleDismissFinishEditing(){this.clearTemporaryItem(),this.undoRedoManager.clearUndoStack(),this.exitFullscreen()}exitFullscreen(){window.parent.postMessage({apiVersion:1,type:"exitFullscreen",position:{top:window.scrollY}},"*"),this.isHidden=!0}clearTemporaryItem(){this.finishedEditing=null,this.temporaryCollectionItemNodeId=void 0}};Ne=ne(null),Zn=new WeakMap,Jn=new WeakMap,Qn=new WeakMap,ei=new WeakMap,S(Ne,4,"isHidden",bf,ct,Zn),S(Ne,4,"finishedEditing",vf,ct,Jn),S(Ne,4,"_screenWidth",Ff,ct,Qn),S(Ne,4,"_temporaryCollectionItemNodeId",Pf,ct,ei),ie(Ne,ct);function ip(r,o){let e=r.getSlugVariable();if(e?.associatedStringVariable){let t=o.getControlProp(e.associatedStringVariable);if(t&&t.type==="string"&&z(t.value)&&t.value.trim())return t.value.trim()}return"a new page"}var zr=class{updateComponentLoader(o,e){F.setModuleRevision(e,0);for(let t of o)F.updateEntity(t.identifier,t)}};var ap=0,Sf,Wr,ti,po;Sf=[D()];var mo=class{constructor(o){this.scheduler=o;N(this,ti,C(Wr,8,this)),C(Wr,11,this);N(this,po);window.addEventListener("resize",()=>{this._editableNodesHighlight&&(this._editableNodesHighlight=void 0)})}get editableNodesHighlight(){return this._editableNodesHighlight}onChangeRoute(){this._editableNodesHighlight&&(this._editableNodesHighlight=void 0)}cleanupAnimationOnFinish(o){zt(this,po)&&clearTimeout(zt(this,po)),No(this,po,window.setTimeout(()=>{this._editableNodesHighlight=void 0},o+100))}highlight(o,{type:e}){let t=pe({screenWidth:o.stores.canvasStore.screenWidth,tree:o.stores.treeStore.tree,webPageNodeId:o.stores.routeStore.webPageNodeId});if(!t)return;let n=[],i={x:0,y:window.scrollY,width:window.innerWidth,height:window.innerHeight},a=1/0,s=-1/0,l=!1;for(let c of t.walk())for(let[m]of c.cache.iterateRenderInstances()){if(!Me.isHighlightableNode(o,c,m))continue;l=!0;let d=o.tree.convertFrameToCanvas(c,void 0,m);if(!sp(i,d))continue;a=Math.min(a,d.y),s=Math.max(s,d.y+d.height);let u=o.tree.getRect(c,void 0,void 0,void 0,m),g=o.tree.transformMatrixToNode(c,void 0,void 0,m);n.push({renderId:m,width:u.width,height:u.height,transform:g.toString(),centerX:d.x+d.width/2,centerY:d.y+d.height/2})}if(n.length===0)gt({key:"editable-nodes-highlight-empty",type:"add",text:l?"Editable content is out of view, scroll to reveal it":"Content is not editable on this page",variant:"info"}),this._editableNodesHighlight=void 0;else{let c=e==="clickOnVoid",m=c?o.stores.mouseStore.windowMousePosition.x:i.width,d=c?o.stores.mouseStore.windowMousePosition.y:i.height/2,u=c?o.stores.mouseStore.canvasMousePosition.y:o.stores.mouseStore.scrollPosition.y,g=400,f=Math.max(m,window.innerWidth-m),w=Math.max(d,window.innerHeight-d),h=Math.sqrt(f**2+w**2)+g,P=Math.max(500,e==="clickOnVoid"?h:h*2),A=5,b=Math.max(0,Math.floor(a-A)),q=Math.ceil(s+A),K=lp(n,h,m,u);this._editableNodesHighlight={animationId:`editable-nodes-highlight-${ap++}`,minY:b,maxY:q,originX:m,originY:d-b+i.y,highlights:n,minRadius:K,maxRadius:h,gradientSize:g,animationDuration:P},this.cleanupAnimationOnFinish(P)}}};Wr=ne(null),ti=new WeakMap,po=new WeakMap,S(Wr,4,"_editableNodesHighlight",Sf,mo,ti),ie(Wr,mo);function sp(r,o){return!(o.x>=De.maxX(r)||De.maxX(o)<=r.x||o.y>=De.maxY(r)||De.maxY(o)<=r.y)}function lp(r,o,e,t){let n=1/0;for(let i of r){let a=Math.sqrt(i.width**2+i.height**2),s=Math.abs(i.centerX-e),l=Math.abs(i.centerY-t),c=Math.sqrt(s**2+l**2),m=Math.max(0,c-a/2);n=Math.min(n,m)}return Number.isFinite(n)&&n<o?n:0}var Hr=class extends Ns{constructor(){super(...arguments);I(this,"hostnames");I(this,"testing",{setHostnames:e=>{this.hostnames=e}})}get customHostnameString(){return this.hostnames?.find(e=>e.type==="custom")?.hostname}get defaultHostnameString(){return this.hostnames?.find(e=>e.type==="default")?.hostname}async loadHostnames(e){let{hostnames:t}=await Ts(e);this.hostnames=t}};var jr=class extends Re{constructor(e){super();this.sandboxStore=e}async ensureModuleEvaluatedInSandbox(e){return(await this.sandboxStore.getModulesRuntime()).loadModule(e.value)}hasModuleForIdentifier(e){return!!F.componentForIdentifier(e.value)}};var _r=class extends Re{constructor(e){super();this.accessStore=e;I(this,"isLoginInProgress",!1)}login(){let e=window.open(`${Bo().login}?closeAfterSuccess=true`,"_blank");return e?this.startLoginWindowClosedPolling(e):Promise.resolve()}startLoginWindowClosedPolling(e){return this.isLoginInProgress=!0,new Promise(n=>{let i=setInterval(async()=>{e.closed&&(clearInterval(i),await this.accessStore.refresh(),this.isLoginInProgress=!1,n())},500)})}};var Ef,Tf,Nf,Af,Df,Bf,Rf,kf,Of,L,oi,ri,ni,ii,ai,si,li,ci;Of=[D()],kf=[D(ae.isEqual)],Rf=[D(ae.isEqual)],Bf=[D()],Df=[Tt(ae.isEqual)],Af=[D()],Nf=[D()],Tf=[D()],Ef=[D()];var Fe=class{constructor(o){this.scheduler=o;C(L,5,this);N(this,oi,C(L,8,this)),C(L,11,this);N(this,ri,C(L,12,this,ae(0,0))),C(L,15,this);N(this,ni,C(L,16,this,ae(0,0))),C(L,19,this);N(this,ii,C(L,20,this,!1)),C(L,23,this);N(this,ai,C(L,24,this,!1)),C(L,27,this);N(this,si,C(L,28,this,!1)),C(L,31,this);N(this,li,C(L,32,this,{canvasMousePosition:ae(0,0),windowMousePosition:ae(0,0)})),C(L,35,this);N(this,ci,C(L,36,this,{canvasMousePosition:ae(0,0),windowMousePosition:ae(0,0)})),C(L,39,this);let e=this.onMouseMove.bind(this);document.addEventListener("mousemove",e);let t=this.onScroll.bind(this);document.addEventListener("scroll",t);let n=this.onMouseDown.bind(this);document.addEventListener("mousedown",n);let i=this.onMouseUp.bind(this);document.addEventListener("mouseup",i)}get lastUpdateType(){return this._lastUpdateType}get scrollPosition(){return this._scrollPosition}get windowMousePosition(){return this._windowMousePosition}get isMouseDown(){return this._isMouseDown}get canvasMousePosition(){return ae.add(this.windowMousePosition,this.scrollPosition)}get isHoveringChrome(){return this._isHoveringChrome}get isHoveringFloatingCanvasChrome(){return this._isHoveringFloatingCanvasChrome}get latest(){return this._latest}get previous(){return this._previous}updateInputState(){this._previous={canvasMousePosition:this._latest.canvasMousePosition,windowMousePosition:this._latest.windowMousePosition},this._latest={canvasMousePosition:this.canvasMousePosition,windowMousePosition:this.windowMousePosition}}onScroll(){this._scrollPosition=ae(window.scrollX,window.scrollY),this._lastUpdateType="scroll",this.updateInputState()}onMouseMove(o){this._isHoveringChrome=tc(o.target),this._isHoveringFloatingCanvasChrome=oc(o.target),this._windowMousePosition=ae(o.clientX,o.clientY),this._lastUpdateType="mouseMove",this.updateInputState()}onMouseDown(o){this._isMouseDown=!0,this._lastUpdateType="mouseDown",this.updateInputState()}onMouseUp(){this._isMouseDown=!1,this._lastUpdateType="mouseUp",this.updateInputState()}};L=ne(null),oi=new WeakMap,ri=new WeakMap,ni=new WeakMap,ii=new WeakMap,ai=new WeakMap,si=new WeakMap,li=new WeakMap,ci=new WeakMap,S(L,4,"_lastUpdateType",Of,Fe,oi),S(L,4,"_scrollPosition",kf,Fe,ri),S(L,4,"_windowMousePosition",Rf,Fe,ni),S(L,4,"_isMouseDown",Bf,Fe,ii),S(L,2,"canvasMousePosition",Df,Fe),S(L,4,"_isHoveringChrome",Af,Fe,ai),S(L,4,"_isHoveringFloatingCanvasChrome",Nf,Fe,si),S(L,4,"_latest",Tf,Fe,li),S(L,4,"_previous",Ef,Fe,ci),ie(L,Fe);var qr=class extends Re{constructor(){super(...arguments);I(this,"colorModel","HEX")}};var Mf=y(oe());var Kr=class extends Re{constructor(e,t){super();this.assetStore=e;this.treeStore=t;I(this,"_hasPermanentlyFailed",!1);I(this,"project");I(this,"projectPromise",new Ht);I(this,"filePickerRef",(0,Mf.createRef)())}get hasPermanentlyFailed(){return this._hasPermanentlyFailed}getProject(){return this.projectPromise}get resourceLimits(){}get featureFlags(){}get projectLicenseType(){return"freeSite"}loadProject(e,t){eo(),!this.project&&(this.project=new Jl(this.treeStore.timeline,e,t),this.project.connect(),this.project.on("disconnect",this.onDisconnect,this),this.project.connection.on("disconnect",this.onDisconnect,this),this.project.on("update",n=>{this.treeStore.newTreeAfterRemoteUpdate(n)}),this.assetStore.setAssetService(this.project.assetService),this.projectPromise.resolve(this.project))}onDisconnect(e){ks(e)||(this._hasPermanentlyFailed=!0,e==="ClientNeedsUpdate"?gt({type:"add",variant:"warning",text:"A new version of Framer is available. Please reload the page to continue working.",key:"client-outdated",duration:1/0,icon:"warning",showCloseButton:"never"}):e==="Maintenance"?gt({type:"add",variant:"warning",text:"Framer is undergoing maintenance. Please reload to continue once we\u2019re back.",key:"maintenance-mode",duration:1/0,icon:"warning",showCloseButton:"never",action:{title:"Reload",onClick:()=>window.location.reload()}}):gt({type:"add",variant:"error",text:"Connection error: "+e,key:"connection-error",duration:1/0,icon:"error",showCloseButton:"never"}))}commitTreeAndSend(e=!0){p(this.project,"Project must be initialized"),p(!this.hasPermanentlyFailed,"Project is permanently failed");let t=this.treeStore.timeline.commitLocalTree();this.treeStore.newTreeAfterLocalUpdate(t,e),this.project.maybeSend()}};var Vf,Lf,zf,et,di,fi,mi;zf=[D()],Lf=[D()],Vf=[D()];var Ut=class{constructor(o,e){this.scheduler=o;this.onChangeRoute=e;N(this,di,C(et,8,this)),C(et,11,this);N(this,fi,C(et,12,this)),C(et,15,this);N(this,mi,C(et,16,this,re)),C(et,19,this);let t=({data:n})=>{if(mt(n)&&n.apiVersion===1){let{type:i,nodeIds:a}=n;if(i==="updateNodeIds"&&mt(a)){let{webPageNodeId:s,collectionItemNodeId:l,activeLocaleId:c}=a;this._webPageNodeId=z(s)?s:void 0,this._collectionItemNodeId=z(l)?l:void 0,this.localeId=z(c)&&ze("onPageLocalizationSupport")?c:re,this.onChangeRoute()}}};window.addEventListener("message",t),window.parent.postMessage({apiVersion:1,type:"initializeComponent",component:"OnPageActiveRouteStore"},"*")}get collectionItemNodeId(){return this._collectionItemNodeId}get webPageNodeId(){return this._webPageNodeId}get projectLinkNodeId(){return this._collectionItemNodeId??this._webPageNodeId}};et=ne(null),di=new WeakMap,fi=new WeakMap,mi=new WeakMap,S(et,4,"_collectionItemNodeId",zf,Ut,di),S(et,4,"_webPageNodeId",Lf,Ut,fi),S(et,4,"localeId",Vf,Ut,mi),ie(et,Ut);var Wf="icxp2h1";var Gr=class extends Re{constructor(e,t,n,i){super();this.componentsStore=e;this.treeStore=t;this.performanceTracker=n;this.updateGenerator=i;I(this,"config",ul.onPageCanvas);I(this,"iframe");I(this,"remoteSandbox");I(this,"remoteControlsVisibility",new Ht);I(this,"remoteModulesRuntime",new Ht);I(this,"_canvasHeight");I(this,"webPageNodeIdToInitialLoadPromise",new Map);window.addEventListener("scroll",()=>{this.remoteSandbox?.scrollTo({behavior:"instant",top:window.scrollY})})}getControlsVisibility(){return this.remoteControlsVisibility}getModulesRuntime(){return this.remoteModulesRuntime}get canvasHeight(){return this._canvasHeight}loadSandbox(){eo(),p(!this.iframe,"Sandbox already loaded");let e=document.createElement("iframe");e.src=this.config.url,e.allow=fl("on_page"),e.sandbox.add("allow-scripts","allow-same-origin"),e.tabIndex=-1,e.id="canvas_sandbox",e.className=Wf;let t=this.initializeSandbox.bind(this,e);e.addEventListener("load",t),this.iframe=e,this.hide(),document.body.append(e)}getInitialLoadPromise(e){let t=this.webPageNodeIdToInitialLoadPromise.get(e)??new Ht;return this.webPageNodeIdToInitialLoadPromise.set(e,t),t}async waitForInitialLoad(e){this.performanceTracker.reportCanvasLoaderViewed(),await this.getInitialLoadPromise(e)}async initializeSandbox(e){let t=e.contentWindow;p(t,"Sandbox didn't load correctly");let n=new ml(at);n.setLocal(at.channels.componentsStore,this.componentsStore),n.setLocal(at.channels.sandboxStore,this),n.setLocal(at.channels.treeStore,this.treeStore);let i=n.getRemote(at.channels.sandbox),a=n.getRemote(at.channels.controlsVisibility),s=n.getRemote(at.channels.modulesRuntime),l=n.getRemote(at.channels.flags);await n.connect({target:t,url:this.config.origin}),this.remoteSandbox=i,this.remoteControlsVisibility.resolve(a),this.remoteModulesRuntime.resolve(s),new pl(l)}onHeightChange(e){this._canvasHeight=e}onInitialLoadComplete(e){this.performanceTracker.reportCanvasReady(),this.getInitialLoadPromise(e).resolve()}update(){let e=this.remoteSandbox;if(!e)return;let t=this.updateGenerator.getUpdate();Do(t)||e.update(t)}hide(){p(this.iframe,"Sandbox not loaded"),this.iframe.setAttribute("aria-hidden","true")}show(){p(this.iframe,"Sandbox not loaded"),this.iframe.removeAttribute("aria-hidden")}};var Hf,pi;Hf=[Tt()];var uo=class{constructor(o,e,t){this.scheduler=o;this.routeStore=e;this.treeStore=t;C(pi,5,this)}get active(){let o=st({tree:this.treeStore.tree,webPageNodeId:this.routeStore.webPageNodeId});return B(o,"webPageNode must be defined"),o}};pi=ne(null),S(pi,2,"active",Hf,uo),ie(pi,uo);function jf({editorNode:r,screenWidth:o,tree:e,webPageNodeId:t,windowMousePositionOnToolEntry:n}){let i=pe({screenWidth:o,tree:e,webPageNodeId:t});if(!i)return;let a=e.convertFrameToCanvas(r),s=e.getNodesInRect(i,a,!0),l=[],c=i.cache.layoutTemplateRects;if(c)for(let[A,b]of c)!b.canvasRect||!De.intersects(b.canvasRect,a)||l.push(new fa({zIndex:b.domRect.zIndex,id:A,parentid:i.id}));let m=s.concat(l),d=Yo(m,e,{[i.id]:l}),u=d.findIndex(A=>A.id===r.id);if(u===-1)return;let g=d.slice(u+1);if(g.length===0)return;let w=e.transformMatrixToNode(r).inverse(),h=n?{x:n.x+window.scrollX,y:n.y+window.scrollY,width:1,height:1}:void 0,P=[];for(let A of g){let b=c?.get(A.id),q=e.convertFrameToCanvas(A);if(h&&De.intersects(h,q))continue;let K;if(b?.canvasCorners?K=b.canvasCorners:K=e.convertCornerPointsToCanvas(A),K.length===0)continue;let se=[];for(let{x:Ke,y:Ve}of K){let Ge=new DOMPoint(Ke,Ve).matrixTransform(w);se.push({x:Ge.x,y:Ge.y})}se.length!==0&&P.push(se)}if(P.length!==0)return{editorRect:a,polygons:P}}function _f({editorRect:r,polygons:o}){let e=`M ${-wt},${-wt} L ${-wt},${r.height+wt} L ${r.width+wt},${r.height+wt} L ${r.width+wt},${-wt} Z`;for(let t of o){let n=t[0];if(!n)continue;let i=[...t,n];for(let a of i)e+=` L ${a.x},${a.y}`;e+=" Z"}return`path("${e}")`}function qf(r){let o=[];for(let e of r){if(e.length===0)continue;let[t,...n]=e;if(!t)continue;let i=`M ${t.x},${t.y}`;for(let a of n)i+=` L ${a.x},${a.y}`;i+=" Z",o.push(i)}if(o.length!==0)return`path("${o.join(" ")}")`}var wt=100;var Kf,Gf,Yf,$f,Xf,Zf,Jf,Qf,J,ui,gi,yi,hi,Ii,go,Ui;Qf=[D()],Jf=[D()],Zf=[D()],Xf=[D()],$f=[D()],Yf=[D()],Gf=[Tt()],Kf=[Tt()];var Ae=class{constructor(o,e,t,n,i){this.scheduler=o;this.treeStore=e;this.routeStore=t;this.canvasStore=n;this.mouseStore=i;C(J,5,this);N(this,ui,C(J,8,this)),C(J,11,this);N(this,gi,C(J,12,this,on)),C(J,15,this);N(this,yi,C(J,16,this)),C(J,19,this);N(this,hi,C(J,20,this,null)),C(J,23,this);N(this,Ii,C(J,24,this)),C(J,27,this);N(this,go);N(this,Ui,C(J,28,this)),C(J,31,this)}get tool(){return this._tool}set tool(o){No(this,go,this.mouseStore.windowMousePosition),this._tool!==o&&(this._tool?.stop?.(),this._tool=o)}get windowMousePositionOnToolEntry(){return zt(this,go)}get editorClipGeometryEntry(){let o=this.nodeInTextEditorId;if(!o||o===on)return null;let e=vt(o),t=this.treeStore.tree.get(e);if(!t)return null;let n=jf({domLayoutUpdate:this.treeStore.domLayoutUpdate,editorNode:t,screenWidth:this.canvasStore.screenWidth,tree:this.treeStore.tree,webPageNodeId:this.routeStore.webPageNodeId,windowMousePositionOnToolEntry:zt(this,go)});return n?{nodeId:e,geometry:n}:null}get editorOverlayClipPath(){let o=this.editorClipGeometryEntry;if(o)return _f(o.geometry)}get sandboxNodeInTextEditorClipPath(){let o=this.editorClipGeometryEntry;if(o)return qf(o.geometry.polygons)}validateCollectionControl(o){let e="required";if(!o)return;let{collectionItemNode:t,variableDefinition:n,collectionNode:i,controlDescription:a,controlProp:s}=o,l;(Vo(n)||wo(n))&&(l=cr(n,i.variables,t));let c=lr(i,t),m=n.type,d=dr(m,a,s,l,void 0,Lo(n),c.get(n.id));this.validationWarning=d?.type===e?void 0:d}};J=ne(null),ui=new WeakMap,gi=new WeakMap,yi=new WeakMap,hi=new WeakMap,Ii=new WeakMap,go=new WeakMap,Ui=new WeakMap,S(J,4,"highlightedRenderId",Qf,Ae,ui),S(J,4,"nodeInTextEditorId",Jf,Ae,gi),S(J,4,"proseMirror",Zf,Ae,yi),S(J,4,"proseMirrorView",Xf,Ae,hi),S(J,4,"_tool",$f,Ae,Ii),S(J,4,"validationWarning",Yf,Ae,Ui),S(J,2,"editorClipGeometryEntry",Gf,Ae),S(J,2,"editorOverlayClipPath",Kf,Ae),ie(J,Ae);var em,tm,Mt,wi,Ci;tm=[D()],em=[D()];var Vt=class{constructor(o,e,t){this.scheduler=o;this.routeStore=e;this.undoRedoManager=t;I(this,"layoutCache",new Cs);I(this,"sandboxCollectionData",new xs("editor"));I(this,"sandboxVisibility",new Ps("editor"));N(this,wi,C(Mt,8,this,Ca.createWithRouteSegmentRoot())),C(Mt,11,this);N(this,Ci,C(Mt,12,this,0)),C(Mt,15,this);I(this,"timeline",new vs(this.tree));I(this,"treeIndexes",new xi(this))}get tree(){return this._tree}get domLayoutUpdate(){return this._domLayoutUpdate}get remoteTreeVersion(){return this.timeline.remoteTreeVersion}getChangesForUndo(){let o=this.timeline.getLatestChangesForUndo();return o?o.filter(e=>!e.ignoreInUndo):[]}hasChanged(){return this.undoRedoManager.getUndoBufferSize()>0}getPartialIndexes(){return this.treeIndexes}getLoadedIndexes(){let o=this.tree.getService("loader");if(o){let e=o.numberOfScopesToLoad();throw new Error(`Some scopes are still loading: ${e} scopes left to load`)}return this.treeIndexes}onLayoutMeasure(o){let e=this.layoutCache.processLayoutMeasurements(o);e.size===0||Qa(this.tree,this.layoutCache,e).size===0||this._domLayoutUpdate++}onSandboxRendered(o){let e=new Set;if(o.collectionUpdates){let t=this.sandboxCollectionData.import(o.collectionUpdates);for(let n of t){let i=vt(n);e.add(i)}}if(o.visibilityUpdates){let t=this.sandboxVisibility.import(o.visibilityUpdates);for(let n of t){let i=vt(n);e.add(i)}}if(e.size>0){let t=bs(this.tree,e);Zo(this.tree,this.layoutCache,this.sandboxCollectionData,this.sandboxVisibility,F.activeBundleHash,this.routeStore.localeId,void 0,t)}o.layoutMeasurements&&this.onLayoutMeasure(o.layoutMeasurements)}newTreeAfterRemoteUpdate(o){o.inEditor=!0,this._tree!==o&&(this._tree=o)}newTreeAfterLocalUpdate(o,e){if(o.inEditor=!0,this._tree===o)return;this._tree=o;let t=this.getChangesForUndo();e&&t.length>0&&this.undoRedoManager.addUndoEntry({changes:t})}};Mt=ne(null),wi=new WeakMap,Ci=new WeakMap,S(Mt,4,"_tree",tm,Vt,wi),S(Mt,4,"_domLayoutUpdate",em,Vt,Ci),ie(Mt,Vt);var xi=class{constructor(o){this.treeStore=o;I(this,"codeComponentNodeCache");I(this,"richTextNodeCache")}get codeComponents(){let o=this.treeStore.tree;if(this.codeComponentNodeCache?.tree===o)return this.codeComponentNodeCache.codeComponentNodes;let e=[];for(let t of o.root.walk())Be(t)&&e.push(t);return this.codeComponentNodeCache={tree:o,codeComponentNodes:e},e}get richTextNodes(){let o=this.treeStore.tree;if(this.richTextNodeCache?.tree===o)return this.richTextNodeCache.richTextNodes;let e=[];for(let t of o.root.walk())E(t)&&e.push(t);return this.richTextNodeCache={tree:o,richTextNodes:e},e}};var Yr=class extends Bs{};var $r=class{constructor(o,e,t){I(this,"accessStore");I(this,"assetStore");I(this,"canvasStore");I(this,"componentsStore");I(this,"contextMenuStore");I(this,"editableNodeHighlightStore");I(this,"hostnameStore");I(this,"loadedExternalModulesStore");I(this,"loginStore");I(this,"modalStore");I(this,"modulesStore");I(this,"mouseStore");I(this,"persistedUserDefaults");I(this,"projectStore");I(this,"routeStore");I(this,"sandboxStore");I(this,"scopeStore");I(this,"toolStore");I(this,"treeStore");I(this,"undoRedoManager",new Yr);I(this,"vectorsStore");this.assetStore=new Ot(e),this.editableNodeHighlightStore=new mo(e),this.routeStore=new Ut(e,()=>o.onChangeRoute()),this.componentsStore=new zr,this.contextMenuStore=Es.new(e),this.hostnameStore=Hr.new(e),this.modalStore=xa.new(e),this.treeStore=new Vt(e,this.routeStore,this.undoRedoManager),this.projectStore=Kr.new(e,this.assetStore,this.treeStore),this.accessStore=Lr.new(e,this.projectStore,this.hostnameStore,t),this.loginStore=_r.new(e,this.accessStore),this.mouseStore=new Fe(e),this.canvasStore=new ct(e,this.accessStore,this.routeStore,this.treeStore,this.projectStore,this.modalStore,this.undoRedoManager,()=>o.exitTool(),()=>o.onChangeRoute()),this.toolStore=new Ae(e,this.treeStore,this.routeStore,this.canvasStore,this.mouseStore),this.scopeStore=new uo(e,this.routeStore,this.treeStore),this.sandboxStore=Gr.new(e,this.componentsStore,this.treeStore,o.performanceTracker,o.sandboxUpdateGenerator),this.loadedExternalModulesStore=jr.new(e,this.sandboxStore),this.modulesStore=Is.new(e,this.treeStore,this.loadedExternalModulesStore,{codeEditorPreviewVisible:!1,mainView:0},this.projectStore.getProject().then(n=>n.modulesAPI),()=>{throw new Error("Can't make document readonly")},async n=>{await(await this.sandboxStore.getModulesRuntime()).insertTemporaryImportMap(n)},async()=>{throw new Error("Can't load all local modules")}),this.persistedUserDefaults=qr.new(e),this.vectorsStore=Rs.new(e,this.modulesStore)}};var Xr=class{constructor(){I(this,"editorBarReadyAt");I(this,"canvasReadyAt");I(this,"canvasLoaderViewedAt")}get editorBarReadyMs(){let o=dp();if(!(Se(o)||Se(this.editorBarReadyAt)))return this.editorBarReadyAt-o}get canvasReadyMs(){if(!(Se(this.canvasReadyAt)||Se(this.editorBarReadyAt)))return this.canvasReadyAt-this.editorBarReadyAt}get perceivedCanvasLoadMs(){if(!Se(this.canvasReadyAt))return Se(this.canvasLoaderViewedAt)?0:Math.min(this.canvasReadyAt-this.canvasLoaderViewedAt,0)}reportEditorBarReady(){this.editorBarReadyAt=Date.now()}reportCanvasLoaderViewed(){this.canvasLoaderViewedAt=Date.now()}reportCanvasReady(){this.canvasReadyAt=Date.now(),this.sendCanvasLoadedEvent()}sendCanvasLoadedEvent(){let{canvasReadyMs:o,editorBarReadyMs:e,perceivedCanvasLoadMs:t}=this;Se(o)||Se(e)||Se(t)||ke("editor_bar_canvas_loaded",{editorBarReadyMs:e,canvasReadyMs:o,perceivedCanvasLoadMs:t})}};function dp(){let r=new URLSearchParams(window.location.search).get("loadStart");if(!r)return;let o=Number(r);if(!Number.isNaN(o))return o}var Zr=class{constructor(o){this.engine=o;I(this,"partialTreeSender");I(this,"previousWebPageNodeId");I(this,"previousCollectionItemNodeId");I(this,"previousBreakpointNodeId");I(this,"previousTemporaryCollectionItemNodeId");I(this,"previousStylePresetBreakpointClassNames");I(this,"previousLocalModules");I(this,"previousDependenciesModule");I(this,"previousAssets");I(this,"previousNodeInTextEditor");I(this,"previousNodeInTextEditorClipPath");I(this,"previousMoveToolState");I(this,"previousLocaleId")}getUpdate(){let{canvasStore:o,modulesStore:e,routeStore:t,assetStore:n,treeStore:i,toolStore:a}=this.engine.stores,s={},l=st({tree:i.tree,webPageNodeId:t.webPageNodeId})?.id;l!==this.previousWebPageNodeId&&(this.previousWebPageNodeId=l,s.webPageNodeId=l);let c=Je(t,i,o)?.id;c!==this.previousCollectionItemNodeId&&(this.previousCollectionItemNodeId=c,s.collectionItemNodeId=c);let m=pe({screenWidth:o.screenWidth,tree:i.tree,webPageNodeId:t.webPageNodeId})?.id;m!==this.previousBreakpointNodeId&&(this.previousBreakpointNodeId=m,s.breakpointNodeId=m);let d=o.temporaryCollectionItemNodeId??null;d!==this.previousTemporaryCollectionItemNodeId&&(this.previousTemporaryCollectionItemNodeId=d,s.temporaryCollectionItemNodeId=d);let u=i.tree.getPresetsListNode(),g=fp(u,o.screenWidth);g!==this.previousStylePresetBreakpointClassNames&&(this.previousStylePresetBreakpointClassNames=g,s.stylePresetBreakpointClassNames=g);let f=e.localModules;f!==this.previousLocalModules&&(this.previousLocalModules=f,s.localModules=new Map(f));let w=e.dependenciesModule;w!==this.previousDependenciesModule&&(this.previousDependenciesModule=w,s.dependenciesModule=w);let h=n.assets;h!==this.previousAssets&&(this.previousAssets=h,s.assets=h),this.partialTreeSender??=new gl(i.timeline,"canvas");let P=this.partialTreeSender.update(l);Do(P)||(s.partialTreeUpdate=P);let A=a.nodeInTextEditorId??null;A!==this.previousNodeInTextEditor&&(this.previousNodeInTextEditor=A,s.nodeInTextEditorId=A);let b=a.sandboxNodeInTextEditorClipPath??null;b!==this.previousNodeInTextEditorClipPath&&(this.previousNodeInTextEditorClipPath=b,s.nodeInTextEditorClipPath=b);let q=a.tool instanceof ue?a.tool.state:void 0;return me(q,this.previousMoveToolState)||(this.previousMoveToolState=q,s.moveToolState=q??null),t.localeId!==this.previousLocaleId&&(this.previousLocaleId=t.localeId,s.activeLocaleId=t.localeId),s}},fp=Mi((r,o)=>{let e=yl(r);return hl(e,o)});var Jr=class{constructor(o){this.siteId=o;I(this,"name","OnPageEngine");I(this,"sandboxUpdateGenerator",new Zr(this));I(this,"performanceTracker",new Xr);I(this,"scheduler",new Vr(this));I(this,"stores");this.stores=new $r(this,this.scheduler,o),this.stores.projectStore.getProject().then(e=>{p(this.stores.assetStore.assetService,"assetsService must be initialized"),Us(this,this.stores.assetStore.assetService,this.stores.projectStore.filePickerRef),rs(e.api,this.stores.assetStore.assetService),this.stores.modulesStore.initialize().catch(le),e.connection.on("connect",t=>{t&&this.stores.modulesStore.refresh().catch(le)})})}get tree(){return this.stores.treeStore.tree}startHighlightTool(){this.stores.toolStore.tool=new Me(this)}startComponentInstanceEditTool(o,e){this.stores.toolStore.tool=new He(this,o,e)}startDateVariableEditTool(o,e,t){this.stores.toolStore.tool=new je(this,o,e,t)}startCollectionReferenceVariableEditTool(o,e,t){this.stores.toolStore.tool=new We(this,o,e,t)}startEnumVariableEditTool(o,e,t){this.stores.toolStore.tool=new _e(this,o,e,t)}startImageEditTool(o,e){this.stores.toolStore.tool=new qe(this,o,e)}startRichTextEditTool(o,e,t){this.stores.toolStore.tool=new he(this,o,e,t)}startRichTextVariableEditTool(o,e,t){this.stores.toolStore.tool=new we(this,o,e,t)}startStringVariableEditTool(o,e,t){this.stores.toolStore.tool=new Oe(this,o,e,t)}startMoveTool(o,e,t){this.stores.toolStore.tool=new ue(this,o,e,t)}exitTool(){this.startHighlightTool()}onChangeRoute(){this.stores.editableNodeHighlightStore.onChangeRoute(),this.exitTool()}getStateToken(){return this.stores.undoRedoManager.getUndoBufferSize()}undo(){let{undoRedoManager:o,toolStore:e,projectStore:t}=this.stores;e.tool?.undo?e.tool.undo():o.peekUndo()&&(o.undo(this.tree),t.commitTreeAndSend(!1))}redo(){let{undoRedoManager:o,toolStore:e,projectStore:t}=this.stores;e.tool?.redo?e.tool.redo():o.peekRedo()&&(o.redo(this.tree),t.commitTreeAndSend(!1))}beginUndoGroup(){this.stores.undoRedoManager.beginUndoGroup()}endUndoGroup(){this.stores.undoRedoManager.scheduleEndUndoGroup()}};var Ct=y(U());ki({enableFontStore:!0,fetchGoogleFontsList:Ls,fetchFontshareFontsList:Vs,fetchBuiltInFontsList:Os});async function oE(r,o){let e=new Jr(o);await e.stores.accessStore.set(r),e.stores.sandboxStore.loadSandbox(),Ss(e.stores.assetStore.assetMap),ft.importFramerFonts(Zi),hs(),Object.assign(window,{engine:e,componentLoader:F}),Ms((0,Ct.jsx)(oa.Provider,{value:e,children:(0,Ct.jsx)(tl,{forceDarkMode:!0,children:(0,Ct.jsx)(Va,{mode:"onPageEditing",children:(0,Ct.jsxs)(Ql,{children:[(0,Ct.jsx)(gf,{}),(0,Ct.jsx)(hf,{})]})})})}),document.getElementById("root"))}export{oE as renderEditorBar};
//# sourceMappingURL=https://app.framerstatic.com/render-YIBNND22.mjs.map
